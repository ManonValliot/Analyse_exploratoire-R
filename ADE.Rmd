---
title: "Analyse de la personnalité des consommateurs"
author: "Manon Valliot, Anne-Sophie Nunes, Merve Yildirim"
date: "10 Décembre, 2021"
output:
  html_document:
    toc: true
    toc_float: true
    number_section: true
    df_print: paged
    dev: png
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
/*------------- ASPECT DOC ---------------- */
body {
  font-family: 'Arial';
  font-size: 13px;
}
.content {
    font-weight: bold;
    text-decoration: underline;
    padding-top: 2em;
}
.author{
  font-size: 13px;
  font-style: italic;
  color: #686666;
  font-weight: lighter;
}
.date{
  font-size: 13px;
  font-style: italic;
  color: #686666;
  font-weight: lighter;
}
h1.title {
  font-size: 40px;
  color: #000000;
  font-weight: bold;
}
h1{ /* Présentation du sujet */
font-size: 30px;
color : #353535;
font-weight: bold;
}
h2{ /* Consommation du vin */
font-size: 20px;
color : #353535;
font-weight: bold;
}
h3{ /* État civil */
font-size: 17px;
color : #B21515;
font-weight: bold;
}
code { /* Code block */
    font-family: 'Arial';
    font-size: 15px;
}
a:hover {
 color: #50a0b0; /* couleur plus foncée en survol */
}

/*----------------LES ESPACES-------------*/
.title {
  margin-top: 1.5em !important;
  margin-bottom: 0.75em;
}

.section h1 {
  padding-top: 2.5em !important;
}
.section h2 {
  padding-top: 2em;
}
.section h3, 
.section h4, 
.section h5 { 
  padding-top: 2em;
}

/*----------------ASPECT TABLE DES MATIÈRES-------------*/
.tocify {
  width: 100% !important;
  border: none; /* Pas de contour */
}
.list-group-item {
    color: #685E4F; /* titre non actif */
    font-size: 12px;
    background-color: white;
}
.list-group-item.active {
    color:#B21515; /* titre actif */
    background-color: white;
    border: none;
    font-size: 12px;
}
.list-group-item:hover, 
.list-group-item.active:hover {
    color: #B21515;
    background-color: white;
    font-size: 12px;
}
.row-fluid{
  display: flex; /* Garder le sommaire quand on défile*/
}

</style>


```{css, echo=FALSE}
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
  overflow-y: auto;
}
```

```{css, echo=FALSE}
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}

div.dataTables_wrapper {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
}
.table-wrapper {
  max-height: 400px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning= F, message = F,
               fig.align = "center",
               fig.retina = 2,
               fig.width = 10,
               cache = TRUE,
               cache.lazy = FALSE,
               class.output="scroll-100",
               echo=F)
```


```{r}
library(FactoMineR)
library(factoextra)
library(magrittr)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2) 
library(ggpubr)
library(ggridges)
library(dplyr)
library(DT)
library(corrplot) #matrice de correlation
library(RColorBrewer) #palette de couleur
library(tidyr)# pour drop_na et pivot_*
library(forcats)# pour travailler sur les levels notamment pour les graphiques
library(tidyverse)
library(hrbrthemes)
library(questionr)
library(viridis)
library(plotly)
library(patchwork)
library(babynames)
library(viridis)
library(plyr)
```



# Présentation du sujet 

Une des préocupations majeures des entreprises est de cibler sa clientèle pour optimiser ses profits. Cela passe par l'analyse de la personnalité de ses consommateurs. Nous allons alors faire l'étude des caractérisques des clients qui consomment majoritairement les produits de notre base de données. Puis, nous allons voir comment attirer ces consommateurs. 
Afin de ne pas trop alourdir et rendre redondante notre étude statistique nous allons nous concentrer sur la dépense en consommation de trois produits : $\color{#B21515}{Vin}$, $\color{#B21515}{Viande}$ et $\color{#B21515}{Friandise}$

```{r}
df<-read.table("marketing_campaign.csv", header= T, sep=";", row.names = 1)
```

<p class="content">Présentation de la base de données :</p>
Notre base de données comporte 2240 consommateurs différents avec 28 variables qui les décrivent :
```{r}
col1 <-c("Year_Birth","Education","Marital_Status","Income","Kidhome","Teenhome","Dt_Customer","Recency",
         "Complain")
col2 <- c("Année de naissance","Niveau d'étude","Etat civil",
          "Revenu","Nombre d'enfants dans le ménage","Nombre d'adolescents dans le ménage",
          "Date d'adhésion du client à l'entreprise","Nombre de jours depuis le dernier achat du
          client","1 si le client s'est plaint au cours des 2 dernières années, 0 sinon")
tableau <- cbind(col1,col2)
colnames(tableau) = c("Variables","Définition des variables")

tableau %>% kable(caption = "PERSONNALITÉ DU CLIENT",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed")) 
```

```{r}
col1 <-c("MntWines","MntFruits","MntMeatProducts","MntFishProducts","MntSweetProducts",
         "MntGoldProds")
col2 <- c("Montant dépensé pour le vin au cours des 2 dernières années","Montant dépensé pour les fruits au
          cours des 2 dernières années","Montant dépensé pour la viande au cours des 2 dernières
          années","Montant dépensé pour le poisson au cours des 2 dernières années","Montant dépensé en
          bonbons au cours des 2 dernières années","Montant dépensé en or au cours des 2 dernières
          années")
tableau <- cbind(col1,col2)
colnames(tableau) = c("Variables","Définition des variables")

tableau %>% kable(caption = "PRODUITS",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

```{r}
col1 <-c("NumDealsPurchases","AcceptedCmp1","AcceptedCmp2","AcceptedCmp3","AcceptedCmp4",
         "AcceptedCmp5","Response")
col2 <- c("Nombre d'achats effectués avec une remise","1 si le client a accepté l'offre lors de la
          1ère campagne, 0 sinon","1 si le client a accepté l'offre lors de la 2ème campagne, 0 sinon",
          "1 si le client a accepté l'offre lors de la 3ème campagne, 0 sinon","1 si le client a accepté
          l'offre lors de la 4ème campagne, 0 sinon","1 si le client a accepté l'offre lors de la 5ème
          campagne, 0 sinon","1 si le client a accepté l'offre lors de la dernière campagne, 0 sinon")
tableau <- cbind(col1,col2)
colnames(tableau) = c("Variables","Définition des variables")

tableau %>% kable(caption = "PROMOTIONS",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

```{r}
col1 <-c("NumWebPurchases","NumCatalogPurchases","NumStorePurchases","NumWebVisitsMonth")
col2 <- c("Nombre d'achats effectués sur le site Web de l'entreprise","Nombre d'achats effectués à l'aide
          d'un catalogue","Nombre d'achats effectués directement en magasin","Nombre de visites sur le
          site Web de l'entreprise au cours du dernier mois")
tableau <- cbind(col1,col2)
colnames(tableau) = c("Variables","Définition des variables")

tableau %>% kable(caption = "LIEUX DE MARCHÉ",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```


<p class="content">Valeurs manquantes :</p>
Il y a `r sum(is.na(df))` valeurs manquantes dans la base de données. Nous remarquons que la variable qui comporte le plus de valeurs manquantes (NA) est la variable ***Income***. Il est donc nécessaire d'enlever les consommateurs qui n'ont pas renseignés leur revenu, puisque cette variable est importante pour notre étude où l'on veut segmenter la population en fonction de leur dépense.
```{r}
Filtre <- which(rowSums(is.na(df))==0)
data <- df[Filtre,]
```


<p class="content">Nettoyage de la base :</p>
- Certaines variables ont des modalités trop peu représentées et avec des observations extrêmes, comme $\color{#B21515}{YOLO}$ et $\color{#B21515}{Absurd}$, que nous décidons d'enlever.
- Selon nous, $\color{#B21515}{Alone}$ et $\color{#B21515}{Single}$ ne représentent pas le même type d'individu et la modalité $\color{#B21515}{Alone}$ est également très peu représentée. Nous décidons également de l'enlever. 
- Les variables $\color{#B21515}{Kidhome}$ et $\color{#B21515}{Teenhome}$ sont des entiers, afin de les étudier nous les transformerons en facteur.
- La variable $\color{#B21515}{Income}$ possède trop de modalités, créons plutôt des intervalles de revenu pour que cela soit plus simple et intéressant.
```{r}
data<-data[!(data$Marital_Status=="Absurd" | data$Marital_Status=="Alone" | data$Marital_Status=="YOLO"),]
data$Kidhome <- factor(data$Kidhome)
data$Teenhome <- factor(data$Teenhome)
Revenu<-cut(data$Income, c(1500,15000,20000,30000,45000,65000,80000,700000), include.lowest = TRUE, 
              labels = c("1500-15000", "15000-20000", "20000-30000", "30000-45000",
                         "45000-65000","65000-80000","80000-700000"),dig.lab = 0)
data<-cbind(data,Revenu)
```


<p class="content">Regardons les effectifs des variables personnalité :</p> 
```{r}
library("gridExtra")
library(RGraphics)
```

```{r}
t(table(data$Marital_Status)) %>% 
  kable(caption = "Effectif de Marital Status",align = "c") %>% 
  kable_styling(full_width = FALSE,
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

```{r}
t(table(data$Education)) %>% kable(caption = "Effectif de Education",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

<div style="position:absolute;width:50px;left:300px;">
```{r}
t(table(data$Kidhome)) %>% kable(caption = "Effectif de Kidhome",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
<tr><td>

</td></tr></table></div><div style="position:relative;width:50px;right:-450px;">
```{r}
t(table(data$Teenhome)) %>% kable(caption = "Effectif de Teenhome",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
<tr><td>

</td></tr></table></div>

```{r}
t(table(data$Revenu)) %>% kable(caption = "Effectif de Revenu",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```


# Segmentation des consommateurs
Nous allons étudier dans cette partie, les caractéristiques des consommateurs selon trois produits (vin, viande et les friandises). 


## Consommation de vin 
<p class="content">Intervalle de confiance :</p>
La dépense moyenne en vin s’avère être de `r round(t.test(data$MntWines)$estimate,3)`, avec un intervalle de confiance égal à [`r round(t.test(data$MntWines)$conf.int,3)`] à 95 %. Donc, il y a 95% de chance que la dépense moyenne d'achat soit comprise entre 291 et 319.


### État civil
```{r}
## Thème transparent
transparent_theme <- theme(
 axis.title.x = element_blank(),
 axis.title.y = element_blank(),
 axis.text.x = element_blank(), 
 axis.text.y = element_blank(),
 axis.ticks = element_blank(),
 panel.grid = element_blank(),
 axis.line = element_blank(),
 panel.background = element_rect(fill = "transparent",colour = NA),
 plot.background = element_rect(fill = "transparent",colour = NA))
```

```{r,message=FALSE,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntWines, fill=Marital_Status, color=Marital_Status, 
      y=Marital_Status) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en vin", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntWines) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    'Divorced' = '#FDF6EA',
    'Married' = '#F9E1C0',
    'Single'= '#F4BFA6',
    'Together' = '#E19C92',
    'Widow'= '#C7807D',
    'vin' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -90, xmax=max(data$MntWines))
```

```{r}
resume_MariWines<-data %>%
  group_by(Marital_Status) %>%
  summarise_at(vars(MntWines),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_MariWines %>% kable(full_width = FALSE,
                           align = "c",
                           escape = FALSE,
                           caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(1, background = "#FEE5D9", bold = T) %>% 
  row_spec(5, background = "#DE2D26", bold = T)
```
Les moyennes de ***Divorced*** ou ***Widow*** n'appartiennent pas à l'intervalle de confiance de la dépense moyenne en vin, elles sont plus élevées. On peut imaginer que ces moyennes sont "tirées" par le fait que ces modalités contiennent des individus qui dépensent plus en vin. Ceci est également visible avec le graphique.


<p class="content">Divorced versus Widow :</p>
On veut maintenant tester si la dépense en vin des ***Widow*** est en moyenne plus importante que celle des ***Divorced***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grands.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{Widow} = \mu_{Divorced} \\
        H_1 : \mu_{Widow} > \mu_{Divorced}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
div <- data$MntWines[data$Marital_Status=="Divorced"]
wid <- data$MntWines[data$Marital_Status=="Widow"]

var1 <- round(var.test(wid,div)$p.value,3)
t.test1 <- round(t.test(wid,div,var.equal=TRUE,alternative = "greater")$p.value,3)

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))

```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.746, ce qui est supérieur au risque de première espèce. Il n’y a donc aucune différence significative entre les variances des deux groupes d’échantillons. Par conséquent, nous pouvons utiliser le t-test classique qui suppose l’égalité des variances et qui renforce la puissance du test.

<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value, de 0.177, est supérieure au risque de première espèce on conserve H0. On en conclut que la dépense des ***Widow*** est en moyenne significativement la même que celle des ***Divorced*** au risque de 5%. 

<p class="content">Conclusion :</p>
Les modalités ***Divorced*** et ***Widow*** sont les individus qui dépensent le plus, en moyenne, dans la consommation de vin. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Niveau d'étude
```{r,message=FALSE,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntWines, fill=Education, color=Education, 
      y=Education) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en vin", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntWines) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '2n Cycle'  = '#FDF6EA',
    'Basic' = '#F9E1C0',
    'Graduation'= '#F4BFA6',
    'Master' = '#E19C92',
    'PhD'= '#C7807D',
    'vin' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -90, xmax=max(data$MntWines))
```

```{r}
resume_EduWines<-data %>%
  group_by(Education) %>%
  summarise_at(vars(MntWines),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_EduWines %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(4, background = "#FB6A4A", bold = T) %>% 
  row_spec(5, background = "#DE2D26", bold = T)
```
Seule, la modalité ***Basic***, a une dispersion, une moyenne et une valeur maximale faible. Tous les individus avec un niveau d'étude ***Basic*** ne dépensent pas beaucoup dans le vin. Les moyennes de ***Master*** ou ***PhD*** n'appartiennent pas à l'intervalle de confiance de la dépense moyenne en vin. On peut imaginer que ces moyennes sont "tirées" par le fait que ces modalités contiennent des individus qui dépensent plus en vin. Ceci est également visible avec le graphique.


<p class="content">Master versus PhD :</p>
On veut maintenant tester si la dépense en vin des ***PhD*** est en moyenne plus importante que celle de ***Master***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{PhD} = \mu_{Master} \\
        H_1 : \mu_{PhD} > \mu_{Master}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
phd <- data$MntWines[data$Education=="PhD"]
master <- data$MntWines[data$Education=="Master"]

var1 <- round(var.test(phd,master)$p.value,3)
t.test1 <- round(t.test(phd,master,var.equal=TRUE,alternative = "greater")$p.value,3)

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))

```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.059, ce qui est supérieur au risque de première espèce. Il n’y a donc aucune différence significative entre les variances des deux groupes d’échantillons. Par conséquent nous pouvons utiliser le t-test classique qui suppose l’égalité des variances et qui renforce la puissance du test.

<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value, de 0.002, est inférieure au risque de première espèce on rejette H0. On en conclut que la dépense des ***PhD*** est en moyenne significativement plus importante que celle des ***Master*** au risque de 5%. 


<p class="content">Conclusion :</p>
La modalité ***PhD*** représente les individus qui dépensent le plus, en moyenne, dans la consommation de vin. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Nombre d'enfant

```{r,message=FALSE,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntWines, fill=Kidhome, color=Kidhome, 
      y=Kidhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en vin", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntWines) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'vin' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -90, xmax=max(data$MntWines))
```

```{r}
resume_KidWines<-data %>% 
  group_by(Kidhome) %>%
  summarise_at(vars(MntWines),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_KidWines %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(1, background = "#FEE5D9", bold = T)
```
La relation entre le nombre d'enfant et les dépenses en vin est décroissante. Les consommateurs avec un nombre d'enfant élevé se "mettent tous daccord" sur la dépense qu'ils effectuent dans la consommation de vin. On voit notamment que la moyenne des ***sans enfant à charge*** n'appartient pas à l'intervalle de confiance de la dépense moyenne en vin.


<p class="content">Pas d'enfant à charge :</p>
On veut maintenant tester si la dépense en vin des consommateurs ayant ***0 enfant*** est en moyenne plus importante que la moyenne standard (305 euros). Pour cela, nous devons faire un Sample test. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{0 enfant} = \mu \\
        H_1 : \mu_{0 enfant} > \mu
    \end{array}
\right.
$$

Comme la p-value est de `r round(t.test(data$MntWines[data$Kidhome=="0"],mu=305.1942,alternative = "greater")$p.value,5)`, donc on rejette H0. On en conclut que la dépense de ***0 enfant*** est en moyenne significativement plus importante que celle des autres modalités au risque de 5%. 


<p class="content">Conclusion :</p>
La modalité ***sans enfant à charge*** représente les individus qui dépensent le plus, en moyenne, dans la consommation de vin. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Nombre d'adolescent
```{r,message=FALSE,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntWines, fill=Teenhome, color=Teenhome, 
      y=Teenhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en vin", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntWines) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'vin' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -90, xmax=max(data$MntWines))
```

```{r}
resume_TeenWines<-data %>%
  group_by(Teenhome) %>%
  summarise_at(vars(MntWines),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_TeenWines %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(3, background = "#FC9272", bold = T)
```
Les valeurs statistiques sont globalement semblables. Cependant, on remarque que la modalité ***2 adolescents*** a une moyenne légèrement plus importante et n'appartient pas à l'intervalle de confiance.


<p class="content">Conclusion :</p>
Après la réalisation d'un test, nous observons que la modalité ***2 adolescents*** à charge ne s'écarte pas significativement de la moyenne de dépense standard. Il n'est pas très intéressant de segmenter les consommateurs en fonction du nombre d'adolescents qu'ils ont à charge.


### Revenu
```{r,message=FALSE,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntWines, fill=Revenu, color=Revenu, 
      y=Revenu) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en vin", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntWines) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '1500-15000' = '#FDF6EA',
    '15000-20000' = '#FAE6CA',
    '20000-30000'= '#F7D8BC',
    '30000-45000'= '#F4BFA6',
    '45000-65000'= '#EAAB9D',
    '65000-80000'= '#DB908A',
    '80000-700000'= '#BA7F7C',
    'vin' = 'black')) +
  theme(legend.position = c(0.82, 0.999),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -90, xmax=max(data$MntWines))
```


```{r}
resume_RevWines<-data %>%
  group_by(Revenu) %>%
  summarise_at(vars(MntWines),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_RevWines %>% kable(full_width = FALSE,
                          align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=7,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(5, background = "#EF3B2C", bold = T) %>%
  row_spec(6, background = "#CB181D", bold = T) %>%
  row_spec(7, background = "#99000D", bold = T)
```

Contrairement à la modalité ***15000-20000***, les autres modalités ont une relation entre le revenu et les dépenses en vin croissante. Plus les individus ont un revenu conséquent, plus ils dépensent dans la consommation de vin. On peut donc dire que les consommateurs avec une catégorie de revenu de ***15000-20000*** sont moins sensibles à la dépense en vin. 
<br/>
On remarque égelement que trois catégories de revenus se démarquent par leurs dépenses. Les modaliés ***45000-65000***, ***65000-80000*** et ***80000-700000*** sont celles qui dépensent le plus en vin. Ces fortes différences en moyenne, valeur maximale et écart-type peuvent-être expliquées par la différence de prix des bouteilles de vins. 


<p class="content">45000-65000 versus 65000-80000 :</p>
On veut maintenant tester si la dépense en vin des ***65000-80000*** est en moyenne plus importante que celle de ***45000-65000***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{65000-80000} = \mu_{45000-65000} \\
        H_1 : \mu_{65000-80000} > \mu_{45000-65000}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
un <- data$MntWines[data$Revenu=="45000-65000"]
deux <- data$MntWines[data$Revenu=="65000-80000"]

var1 <- round(var.test(deux,un)$p.value,3)
t.test1 <- t.test(deux,un,var.equal=FALSE,alternative = "greater")$p.value

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))
```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.0004, ce qui est inférieur au risque de première espèce. Il y a donc une différence significative entre les variances des deux groupes d’échantillons. 

<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value est inférieure au risque de première espèce on rejette H0. On en conclut que la dépense de ***65000-80000*** est en moyenne significativement plus importante que celle des ***45000-65000*** au risque de 5%. 


<p class="content">80000-700000 versus 65000-80000 :</p>
On veut maintenant tester si la dépense en vin des ***80000-700000*** est en moyenne plus importante que celle de ***65000-80000***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{80000-700000} = \mu_{65000-80000} \\
        H_1 : \mu_{80000-700000} > \mu_{65000-80000}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
un <- data$MntWines[data$Revenu=="80000-700000"]
deux <- data$MntWines[data$Revenu=="65000-80000"]

var1 <- var.test(un,deux)$p.value
t.test1 <- t.test(un,deux,var.equal=FALSE,alternative = "greater")$p.value

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))

```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.0004, ce qui est inférieur au risque de première espèce. Il y a donc une différence significative entre les variances des deux groupes d’échantillons. 

<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value, de 0.0002, est inférieure au risque de première espèce on rejette H0. On en conclut que la dépense de ***80000-700000*** est en moyenne significativement plus importante que celle des ***65000-80000*** au risque de 5%.

<p class="content">Conclusion :</p>
Les individus ayant la modalité ***80000-700000*** dépensent plus, en moyenne, que ceux ayant la modalité ***65000-80000*** dans le vin ; et les clients ayant un revenu compris entre ***65000-80000***  dépensent plus que ceux ayant la modalité ***45000-65000***. On peut conclure que consommateurs avec les revenus les plus important sont à cibler.



## Consommation de viande

<p class="content">Intervalle de confiance :</p>
La dépense moyenne en viande s’avère être de `r round(t.test(data$MntMeatProducts)$estimate,3)`, avec un intervalle de confiance de [`r round(t.test(data$MntMeatProducts)$conf.int,3)`] à 95 %. Donc 95% de chance que la dépense moyenne d'achat de la population étudiée soit comprise entre 158 et 177.


### État-civil 
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntMeatProducts, fill=Marital_Status, color=Marital_Status, 
      y=Marital_Status) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en viande", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntMeatProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    'Divorced' = '#FDF6EA',
    'Married' = '#F9E1C0',
    'Single'= '#F4BFA6',
    'Together' = '#E19C92',
    'Widow'= '#C7807D',
    'viande' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -100, xmax=max(data$MntMeatProducts))
```

```{r}
resume_MariMeat<-data %>%
  group_by(Marital_Status) %>%
  summarise_at(vars(MntMeatProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_MariMeat %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>% 
  row_spec(0, bold=T) %>%
  row_spec(3, bold=T,background= "#D88E7E") %>%
  row_spec(5, bold=T,background= "#D88E7E") %>%
  column_spec(1,bold=T, color= "black", background= "#D88E7E")
```
On remarque que les modalités ***Widow*** et ***Single*** sont celles qui dépensent en moyenne le plus dans la viande. On remarque également que la dispersion de la dépense en viande de ***Single*** est très élevée, nous supposons donc que certains consommateurs dépensent très peu en viande et d'autres énormément.


<p class="content">Single versus Widow :</p>
On veut maintenant tester si la dépense en viande de la modalité ***Widow*** est en moyenne plus importante que celle des ***Single***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.


Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{Widow} = \mu_{Single} \\
        H_1 : \mu_{Widow} > \mu_{Single}
    \end{array}
\right.
$$
Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
sin <- data$MntMeatProducts[data$Marital_Status=="Single"]
wid <- data$MntMeatProducts[data$Marital_Status=="Widow"]

var1 <- round(var.test(wid,sin)$p.value,3)
t.test1 <- round(t.test(wid,sin,var.equal=TRUE,alternative = "greater")$p.value,3)

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))

```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.168, ce qui est supérieur au risque de première espèce. Il n’y a donc aucune différence significative entre les variances des deux groupes d’échantillons. Par conséquent nous pouvons utiliser le t-test classique qui suppose l’égalité des variances et qui renforce la puissance du test.


<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value, de 0.494, est supérieure au risque de première espèce on conserve H0. On en conclut que la dépense de ***Widow*** est en moyenne significativement la même que celle des ***Single*** au risque de 5%. 


<p class="content">Conclusion :</p>
Les modalités ***Widow*** et ***Single*** représentent les individus qui dépensent le plus, en moyenne, dans la consommation de viande. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Niveau d'étude 
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntMeatProducts, fill=Education, color=Education, 
      y=Education) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en viande", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntMeatProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '2n Cycle'  = '#FDF6EA',
    'Basic' = '#F9E1C0',
    'Graduation'= '#F4BFA6',
    'Master' = '#E19C92',
    'PhD'= '#C7807D',
    'viande' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -100, xmax=max(data$MntMeatProducts))
```

```{r}
resume_EducMeat<-data %>%
  group_by(Education) %>%
  summarise_at(vars(MntMeatProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_EducMeat %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>% 
  row_spec(0, bold=T) %>%
  row_spec(3, bold=T,background= "#D88E7E") %>%
  row_spec(5, bold=T,background= "#D88E7E") %>%
  column_spec(1,bold=T, color= "black", background= "#D88E7E")
```

Malgré une forte dispersion dans toutes modalités (sauf pour les clients ayant un niveau de diplôme ***Basic***), on remarque que les clients qui dépensent en moyenne plus en viande sont ***Graduation***, et ***PhD***. Ce qui n'est pas étonnant puisqu'on suppose que les clients ayant au minimum un niveau de diplôme ***Graduation*** gagnent assez bien leur vie. Cependant, ***PhD** appartient à l'interavalle de confiance donc on ne garde par cette modalité. 

<p class="content"> Graduation versus PhD :</p>
On veut maintenant tester si la dépense en viande de la modalité ***Graduation*** est en moyenne plus importante que celle des ***PhD***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.


Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{Graduation} = \mu_{PhD} \\
        H_1 : \mu_{Graduation} > \mu_{PhD}
    \end{array}
\right.
$$
Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes. 

```{r}
sin <- data$MntMeatProducts[data$Education=="PhD"]
wid <- data$MntMeatProducts[data$Education=="Graduation"]

var1 <- round(var.test(wid,sin)$p.value,3)
t.test1 <- round(t.test(wid,sin,var.equal=TRUE,alternative = "greater")$p.value,3)

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstud0) <- ""

tabstud0 %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
  kable_styling(full_width = FALSE,
                position="center",
                bootstrap_options = c("condensed","hover"))
```
<u> Test de significacité des variances (Fisher) </u> :
La p-value est égale à 0.733, ce qui est supérieur au risque de première espèce. Il n’y a donc aucune différence significative entre les variances des deux groupes d’échantillons. Par conséquent nous pouvons utiliser le t-test classique qui suppose l’égalité des variances et qui renforce la puissance du test.


<u> Test de comparaison des moyennes (Student) </u> : 
Comme la p-value, de 0.213, est supérieure au risque de première espèce on conserve H0. On en conclut que la dépense de ***Graduation*** est en moyenne significativement la même que celle des ***PhD*** au risque de 5%. 


<p class="content">Conclusion :</p>
Les modalités ***Graduation*** et ***PhD*** représentent les individus qui dépensent le plus, en moyenne, dans la consommation de viande. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Nombre d'enfants
```{r, fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntMeatProducts, fill=Kidhome, color=Kidhome, 
      y=Kidhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en viande", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntMeatProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'viande' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -97, xmax=max(data$MntMeatProducts))
```

```{r}
resume_KidMeat<-data %>%
group_by(Kidhome) %>%
summarise_at(vars(MntMeatProducts),list("moyenne" = mean , "écart-type"
= sd, "maximum" = max))


resume_KidMeat %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>% 
  row_spec(0, bold=T) %>%
  row_spec(1, bold=T,background= "#D88E7E") %>%
  column_spec(1,bold=T, color= "black", background= "#D88E7E")
```
Nous remarquons que les consommateurs n'ayant pas d'enfant sont ceux qui dépensent en moyenne le plus en viande. En effet, la relation entre le nombre d'enfant des consommateurs et la dépense en viande est négative.

<p class="content">Sans enfant à charge :</p>
On veut maintenant tester si la dépense en viande des ***sans enfant à charge*** est en moyenne plus importante que la moyenne standard (167). Pour cela, nous devons faire un Sample test. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{0 enfant} = \mu \\
        H_1 : \mu_{0 enfant} > \mu
    \end{array}
\right.
$$
Comme la p-value est de `r round(t.test(data$MntMeatProducts[data$Kidhome=="0"],mu=167.1612,alternative = "greater")$p.value,5)` donc on rejette H0. On en conclut que la dépense de consommateurs ayant 0 enfant à charge est en moyenne significativement plus importante que celle des autres modalités au risque de 5%. 

<p class="content">Conclusion :</p>
La modalité sans enfant à charge représente les individus qui dépensent le plus en moyenne dans la consommation de viande. Ce sont les consommateurs qu'il faut cibler.


### Nombre d'adolescents
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntMeatProducts, fill=Teenhome, color=Teenhome, 
      y=Teenhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en viande", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntMeatProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'viande' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -95, xmax=max(data$MntMeatProducts))
```

```{r}
resume_TeenMeat<-data %>%
  group_by(Teenhome) %>%
  summarise_at(vars(MntMeatProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_TeenMeat %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>% 
  row_spec(0, bold=T) %>%
  row_spec(1, bold=T,background= "#D88E7E") %>%
  column_spec(1,bold=T, color= "black", background= "#D88E7E")
```
Nous pouvons faire la même hypothèse que pour les consommateurs sans adolescent. En effet, ceux qui dépensent en moyenne le plus sont les clients n'ayant pas d'adolescents. 

<p class="content">Sans adolescent à charge :</p>
On veut maintenant tester si la dépense en viande des ***sans adolescent*** à charge est en moyenne plus importante que la moyenne standard (167). Pour cela, nous devons faire un Sample test. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.

Le test que l'on souhaite réaliser est : 
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{0 adolescent} = \mu \\
        H_1 : \mu_{0 adolescent} > \mu
    \end{array}
\right.
$$
Comme la p-value est de `r round(t.test(data$MntMeatProducts[data$Teenhome=="0"],mu=167.1612,alternative = "greater")$p.value,5)` donc on rejette H0. On en conclut que la dépense des consommateurs ayant 0 adolescent à charge est en moyenne significativement plus importante que celle des autres modalités au risque de 5%. 


<p class="content">Conclusion :</p>
La modalité sans adolescent à charge représente les individus qui dépensent en moyenne le plus dans la consommation de viande. Ce sont les consommateurs à fort potentiel, qu'il faut cibler.


### Revenu
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntMeatProducts, fill=Revenu, color=Revenu, 
      y=Revenu) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en viande", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntMeatProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '1500-15000' = '#FDF6EA',
    '15000-20000' = '#FAE6CA',
    '20000-30000'= '#F7D8BC',
    '30000-45000'= '#F4BFA6',
    '45000-65000'= '#EAAB9D',
    '65000-80000'= '#DB908A',
    '80000-700000'= '#BA7F7C',
    'viande' = 'black')) +
  theme(legend.position = c(0.82, 0.999),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -97, xmax=max(data$MntMeatProducts))
```

```{r}
resume_RevMeat<-data %>%
  group_by(Revenu) %>%
  summarise_at(vars(MntMeatProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))


resume_RevMeat %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>% 
  row_spec(0, bold=T) %>%
  row_spec(6, bold=T,background= "#D88E7E") %>%
  row_spec(7, bold=T,background= "#D88E7E") %>%
  column_spec(1,bold=T, color= "black", background= "#D88E7E")
```
Les consommateurs ayant un revenu compris entre ***65000-80000*** et ***80000-700000*** dépensent en moyenne plus en viande. De plus, il y a une grosse différence de dépense entre les clients qui gagnent entre ***80000-700000*** et ceux qui gagnent entre ***1500-5000***. Ceci n'est pas choquant et est cohérent puisque la viande est un bien onéreux, qui reste parfois inaccessible. 


<p class="content">65000-80000 versus 80000-700000 :</p>
On veut maintenant tester si la dépense en viande des ***80000-700000*** est en moyenne plus importante que celle de ***65000-80000***. Pour cela, nous devons faire un test de Student. Rappelons que pour effectuer un test de Student les échantillons doivent vérifier le test de normalité, ce qui est le cas puisque les effectifs de ces modalités sont très grand.


Le test que l'on souhaite réaliser est :
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{80000-700000} = \mu_{65000-80000} \\
        H_1 : \mu_{80000-700000} > \mu_{65000-80000}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes.
```{r}
revv <- data$MntMeatProducts[data$Revenu=="65000-80000"]
revvv <- data$MntMeatProducts[data$Revenu=="80000-700000"]

var1 <- var.test(revvv,revv)$p.value
t.test1 <- t.test(revvv,revv,var.equal=FALSE,alternative = "greater")$p.value

tabstudi <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstudi) <- c("p-value test égalité variance","p-value test Student")
rownames(tabstudi) <- ""

tabstudi %>% kable(caption = "test de Fisher et test de Student", align="c") %>%
kable_styling(full_width = FALSE,
position="center",
bootstrap_options = c("condensed","hover"))
```

<u> Test de significacité des variances (Fisher) </u> :
La p-value est inférieur au risque de première espèce. Il n’y a donc une différence significative entre les variances des deux groupes d’échantillons.

<u> Test de comparaison des moyennes (Student) </u> :
Comme la p-value est inférieur au risque de première espèce on rejette H0. On en conclue que la dépense de (80000-700000) est en moyenne significativement plus importante que celle des (65000-80000) au risque de 5%.


<p class="content">Conclusion :</p>
***80000-700000*** dépensent plus que ***65000-800000*** dans la viande.



## Consommation de Friandises
<p class="content">Intervalle de confiance :</p>
La dépense moyenne en friandises est égale à `r round(t.test(data$MntSweetProducts)$estimate,3)`. On remarque, de plus, qu'il y a 95% de chances que la dépense moyenne des consommateurs observés soit comprise entre [`r round(t.test(data$MntSweetProducts)$conf.int,3)`].

### État civil
```{r}
h<-mean(data$MntFruits[data$Marital_Status=="Divorced"])+
  mean(data$MntWines[data$Marital_Status=="Divorced"])+
  mean(data$MntMeatProducts[data$Marital_Status=="Divorced"])+
  mean(data$MntFishProducts[data$Marital_Status=="Divorced"])+
  mean(data$MntSweetProducts[data$Marital_Status=="Divorced"])+
  mean(data$MntGoldProds[data$Marital_Status=="Divorced"])
```

```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntSweetProducts, fill=Marital_Status, color=Marital_Status, 
      y=Marital_Status) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en friandises", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntSweetProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    'Divorced' = '#FDF6EA',
    'Married' = '#F9E1C0',
    'Single'= '#F4BFA6',
    'Together' = '#E19C92',
    'Widow'= '#C7807D',
    'friandises' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -15, xmax=max(data$MntSweetProducts))
```

```{r}
resume_MariSweet<-data %>%
  group_by(Marital_Status) %>%
  summarise_at(vars(MntSweetProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))

resume_MariSweet %>% 
  kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "dark", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>% row_spec(row = 5, background = "#cb181d", bold= T)
```
***Remarque :*** Les consommateurs observés veufs ont, en moyenne,tendance à consommer davantage de friandises que les autres consommateurs observés. On observe tout de même, qu'en moyenne, la différence de consommation entre états civils n'est pas importante.

<p class="content">Widow :</p>
Testons à présent si la dépense moyenne en friandises des **Widow** est plus conséquente que la dépense moyenne globale. Il suffit, pour cela, d'effectuer un test de Student. Pour que ce test puisse être effectuer les échantillons de consommateurs observés doivent vérifier le test de normalité, cela se vérifie simplement puisque les effectifs sont assez grands : `r sum(data$Marital_Status=="Widow")` consommateurs observés veufs.

Le test que l'on souhaite réaliser est le suivant :
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{Widow} = \mu \\
        H_1 : \mu_{Widow} > \mu
    \end{array}
\right.
$$

La p-value est de `r round(t.test(data$MntSweetProducts[data$Marital_Status=="Widow"],mu= 27.07469,alternative = "greater")$p.value,5)` donc on rejette $H_0$. La dépense moyenne en friandises des consommateurs observés veufs est donc significativement plus conséquente que celle des autres modalités au risque de 5%.

<p class="content">Conclusion :</p>
La modalité **Widow** dépense en moyenne plus en consommation de
friandises que les autres consommateurs observés. Il est donc
intéressant de cibler cette catégorie de consommateurs.


### Niveau d'étude
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntSweetProducts, fill=Education, color=Education, 
      y=Education) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en friandises", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntSweetProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '2n Cycle'  = '#FDF6EA',
    'Basic' = '#F9E1C0',
    'Graduation'= '#F4BFA6',
    'Master' = '#E19C92',
    'PhD'= '#C7807D',
    'friandises' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -15, xmax=max(data$MntSweetProducts))
```

```{r}
resume_EduSweet<-data %>%
  group_by(Education) %>%
  summarise_at(vars(MntSweetProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))

resume_EduSweet %>% 
  kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "dark", bold = T,
              background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>% row_spec(row = 1, bold = T, background ="#fee5d9") %>% 
  row_spec(row = 3, bold = T, background = "#fb6a4a")
```
***Remarque :*** Les **consommateurs observés étant diplomé du second cycle ou gradués ont, en moyenne, tendance à consommer davantage de friandises que les autres consommateurs observés.

<p class="content">Conclusion :</p>
Après la réalisation d'un test, nous observons que les modalités **2n Cycle** et **Graduation** sont similaires. Il n'est pas très intérressant de segmenter les consommateurs en fonction du niveau d'étude.


### Enfant(s) à charge
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntSweetProducts, fill=Kidhome, color=Kidhome, 
      y=Kidhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en friandises", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntSweetProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'friandises' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -15, xmax=max(data$MntSweetProducts))
```

```{r}
resume_EnfSweet<-data %>%
  group_by(Kidhome) %>%
  summarise_at(vars(MntSweetProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))

resume_EnfSweet %>% 
  kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "dark", bold = T,background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>% row_spec(1, bold = T, background = "#fee5d9")
```

***Remarque :*** Les consommateurs observés n'ayant aucun enfant à charge consomment, en moyenne, davantage de friandises que les autres consommateurs observés. Cette observation peut sembler inatendue puisqu'en général la réflexion initiale concernant la consommation de friandises en fonction du nombre d'enfants à charge aurait tendance à préférer une relation positive.

<p class="content">Sans enfant à charge :</p>
Testons à présent si la dépense moyenne en friandises des **consommateurs sans enfant à charge** est plus conséquente que la dépense moyenne globale. Il suffit, pour cela, d'effectuer un test de Student. Pour que ce test puisse être effectuer les échantillons de consommateurs observés doivent vérifier le test de normalité, cela se vérifie simplement puisque les effectifs sont assez grands : `r sum(data$Kidhome==0)` consommateurs observés sans enfant à charge.

Le test que l'on souhaite réaliser est le suivant :
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{0 enfant} = \mu \\
        H_1 : \mu_{0 enfant} > \mu
    \end{array}
\right.
$$
La p-value est de `r round(t.test(data$MntSweetProducts[data$Kidhome=="0"],mu=27.07469 ,alternative = "greater")$p.value,5)` donc on rejette $H_0$. La dépense moyenne en friandises des consommateurs observés sans enfant à charge est donc significativement plus conséquente que celle des autres modalités au risque de 5%.

<p class="content">Conclusion :</p>
La modalité **sans enfant à charge** dépense en moyenne plus en consommation de friandises que les autres consommateurs observés. Il est donc intéressant de cibler ce type de consommateurs.


### Adolescent(s) à charge
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntSweetProducts, fill=Teenhome, color=Teenhome, 
      y=Teenhome) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en friandises", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))
  
p2 <- ggplot(data=data) +
  aes(x=MntSweetProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '0' = '#F2E5D4',
    '1' = '#FDD7B8',
    '2'= '#EE9990',
    'friandises' = 'black')) +
  theme(legend.position = c(0.85, 0.95),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -15, xmax=max(data$MntSweetProducts))
```

```{r}
resume_AdoSweet<-data %>%
  group_by(Teenhome) %>%
  summarise_at(vars(MntSweetProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))

resume_AdoSweet %>% 
  kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "dark", bold = T,background = brewer.pal(n=6,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>%
  row_spec(1, bold = T, background = "#fee5d9")
```
***Remarque :*** Les consommateurs observés n'ayant aucun adolescent à charge ont, en moyenne, tendance à consommer davantage de friandises que les autres consommateurs observés. Une fois de plus, cette observation peut suprendre pour les mêmes raisons que pour les résultats obtenus en étudiant la consommation de friandises en fonction du nombre d'enfants à charge.

<p class="content">Sans adolescent à charge :</p>
Testons à présent si la dépense moyenne en friandises des **consommateurs sans adolescent à charge** est plus conséquente que la dépense moyenne globale. Il suffit, pour cela, d'effectuer un test de Student. Pour que ce test puisse être effectuer les échantillons de consommateurs observés doivent vérifier le test de normalité, cela se vérifie simplement puisque les effectifs sont assez grands : `r sum(data$Teenhome==0)` consommateurs observés sans adolescent à charge.

Le test que l'on souhaite réaliser est le suivant :
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{0 adolescent} = \mu \\
        H_1 : \mu_{0 adolescent} > \mu
    \end{array}
\right.
$$

La p-value est de `r round(t.test(data$MntSweetProducts[data$Teenhome=="0"],mu=27.07469,alternative = "greater")$p.value,5)` donc on rejette $H_0$. La dépense moyenne en friandises des consommateurs observés sans adolescent à charge est donc significativement plus conséquente que celle des autres modalités au risque de 5%.

<p class="content">Conclusion :</p>
La modalité **sans adolescent à charge** dépense en moyenne plus en consommation de friandises que les autres consommateurs observés. Il serait intéressant de cibler ce type de consommateurs.


### Revenu
```{r,fig.align="center"}
p1 <- ggplot(data=data) +
  aes(x=MntSweetProducts, fill=Revenu, color=Revenu, 
      y=Revenu) +
  scale_fill_brewer(palette = "OrRd") +
  scale_color_brewer(palette = "OrRd") +
  geom_density_ridges(alpha=0.6, scale=6) +
  xlim(0,NA) +
  labs(title = "",
       x = "Dépense en friandises", y="") +
  theme_minimal() +
  theme(legend.position="none") +
  theme(axis.title.x = element_text(hjust=0.6,size=10))

p2 <- ggplot(data=data) +
  aes(x=MntSweetProducts) +
  geom_density() +
  xlim(0,NA) + transparent_theme +
  scale_fill_manual("",values = c(
    '1500-15000' = '#FDF6EA',
    '15000-20000' = '#FAE6CA',
    '20000-30000'= '#F7D8BC',
    '30000-45000'= '#F4BFA6',
    '45000-65000'= '#EAAB9D',
    '65000-80000'= '#DB908A',
    '80000-700000'= '#BA7F7C',
    'friandises' = 'black')) +
  theme(legend.position = c(0.82, 0.999),legend.direction = "horizontal",
        legend.key.size = unit(0.5, "cm"),
  legend.key.width = unit(0.7,"cm")) +
  geom_density(color = "black", linetype = "solid",alpha=0.6, scale=6) +
  guides(fill = guide_legend(override.aes = list(colour = NULL)))

p2_grob = ggplotGrob(p2)

p1 + annotation_custom(grob = p2_grob, xmin= -15, xmax=max(data$MntSweetProducts))
```

```{r}
resume_RevSweet<-data %>%
  group_by(Revenu) %>%
  summarise_at(vars(MntSweetProducts),list("moyenne" = mean , "écart-type"= sd, "maximum" = max))

resume_RevSweet %>% kable(full_width = FALSE,align = "c",escape = FALSE,caption = "") %>%
  kable_styling(c("condensed", "hover"),font_size=13) %>%
  column_spec(1, color = "black", bold = T,
              background = brewer.pal(n=7,name="Reds"), width="5cm") %>%
  row_spec(0, bold = T) %>% 
  row_spec(6, background = "#CB181D", bold = T) %>% 
  row_spec(7, background = "#99000D", bold = T)
```
***Remarque :*** Les consommateurs observés dont le revenu annuel est compris entre **65000 et 700000** ont, en moyenne, tendance à consommer davantage de friandises que les autres consommateurs observés. Cette différence de consommation entre catégories de revenu est, en terme de moyenne, flagrante et s'explique peut être par un pouvoir d'achat plus important.

<p class="content">Revenu 65000-80000 versus Revenu 80000-700000 :</p>
Testons à présent si la dépense moyenne en friandises des **Revenu
80000-700000** est plus conséquente que celle des **Revenu
65000-80000**. Il suffit, pour cela, d'effectuer un test de Student.
Pour que ce test puisse être effectuer les échantillons de consommateurs
observés doivent vérifier le test de normalité, cela se vérifie
simplement puisque les effectifs sont assez grands : `r sum(data$Revenu=="65000-80000")` consommateurs observés avec un revenu
compris entre 65000 et 80000 et `r sum(data$Revenu=="80000-700000")`
consommateurs observés avec un revenu compris entre 80000 et 700000


Le test que l'on souhaite réaliser est le suivant :
$$
\left\{
    \begin{array}{ll}
        H_0 : \mu_{80000-700000} = \mu_{65000-80000} \\
        H_1 : \mu_{80000-700000} > \mu_{65000-80000}
    \end{array}
\right.
$$

Regardons dans un premier temps si les variances sont égales. Puis, effectuons le test de Student pour comparer les moyennes.
```{r}
r1 <- data$MntSweetProducts[data$Revenu=="65000-80000"]
r2 <- data$MntSweetProducts[data$Revenu=="80000-700000"]

var1 <- round(var.test(r2,r1)$p.value,3)
t.test1 <- t.test(r2,r1,var.equal=FALSE,alternative = "greater")$p.value

tabstud0 <- matrix(c(var1,t.test1), nrow=1)
colnames(tabstud0) <- c("p-value test égalité variance","p-value test
Student")
rownames(tabstud0) <- ""

tabstud0 %>% 
  kable(caption = "test de Fisher et test de Student",align="c") %>%
  kable_styling(full_width = FALSE,position="center",bootstrap_options = c("condensed","hover"))
```

<u> Test de significacité des variances (Fisher) : </u>
La p-value est, égale à 0.022, est inférieure au risque de première espèce. Il y a donc une différence significative entre les variances des deux groupes de consommateurs étudiés. Par conséquent nous devons utiliser le *t-test* qui suppose l’inégalité des variances.


<u> Test de comparaison des moyennes (Student) : </u>
La p-value , égale à 2.37e-05 , est inférieure au risque de première espèce on rejette $H_0$. On peut donc en conclure que la dépense des consommateurs avec un revenu compris entre 80000 et 700000 est en moyenne significativement plus élevée que celle des consommateurs avec un revenu compris entre 65000 et 80000 au risque de 5%.


<p class="content">Conclusion :</p>
Ces deux modalités, **Revenu 65000-80000** et **Revenu 80000-700000**, dépensent en moyenne plus en consommation de friandises que les autres consommateurs observés. Il serait intéressant de cibler ces deux
catégories de consommateurs.


# Stratégies commerciales
Durant la première partie de l'étude, pour les trois produits étudiés ($\color{#B21515}{Vin}$, $\color{#B21515}{Viande}$ et $\color{#B21515}{Friandise}$), nous avons trouvés des modalités de variables qui se distinguaient des autres par la dépense en consommation de ces trois biens. Pour cela, nous allons étudier dans cette seconde partie la sensibilité des consommateurs aux promotions ainsi que leurs préférences en termes de lieux de marchés. Cela nous permettra de segmenter le marché et d'identifier les consommateurs à cibler. 

## Sans enfant à charge
À l'aide du tableau de taux de participation, on observe 1279 consommateurs observés sans enfant à charge dans notre base de données.
```{r}
tab_participation <- rbind(table(data[,5]),round((table(data[,5])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction de Kidhome",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.

```{r}
tab <- t(table(data$NumDealsPurchases[data$Kidhome==0])) 
rownames(tab) = c("Effectif")
tab%>%
kable(caption = "Nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Kidhome==0 & data$NumDealsPurchases!=0)/sum(data$Kidhome==0))*100,3)`% des consommateurs observés sans enfant à charge effectuent des achats avec remise. De plus on remarque que les ces consommateurs effectuent entre 1 et 3 achats remisés.
Regardons maintenant, en moyenne, parmi les consommateurs observés sans enfant à charge ceux qui acceptent une offre d'achat lors d'une campagne de remise.

```{r}
un <- sum(data$Kidhome==0&
data$AcceptedCmp1==1)/sum(data$Kidhome==0&
data$AcceptedCmp1==0)*100
deux <- sum(data$Kidhome==0&
data$AcceptedCmp2==1)*(100-un)/sum(data$Kidhome==0&
data$AcceptedCmp2==0)
trois <- sum(data$Kidhome==0&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Kidhome==0&
data$AcceptedCmp3==0)
quatre <- sum(data$Kidhome==0&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Kidhome==0&
data$AcceptedCmp4==0)
cinq <- sum(data$Kidhome==0&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Kidhome==0&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Kidhome0_disc <-cbind(col2,col1)
Kidhome0_disc2 <- cbind(Kidhome0_disc,col3)
colnames(Kidhome0_disc2) = c("Numéro de campagne","%","% cummulés")



Kidhome0_disc2 %>%
kable(caption = "Comportement des consommateurs observés sans enfant à charge face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))

```

Environ 39% des consommateurs observés sans enfant à charge effectuant des achats remisés acceptent une offre d'achat lors des 5 premières campagnes de remises.Seulement, `r round(sum(data$Kidhome==0 & data$Response==1)/sum(data$Kidhome==0)*100,3)` % des consommateurs observés sans enfant à charge effectuant des achats remisés acceptent une offre d'achat lors de la dernière campagne de remise.


```{r}
col1 <- c(sum(data$NumWebPurchases[data$Kidhome==0]), sum(data$NumCatalogPurchases[data$Kidhome==0]), sum(data$NumStorePurchases[data$Kidhome==0]),sum(data$NumWebVisitsMonth[data$Kidhome==0]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés sans enfant à charge",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs sans enfant à charge, on remarque que le nombre total d'achats effectués en magasin est significativement plus important.



<p class="content">Conclusion :</p>
Pour ce qui est des consommateurs observés sans enfant à charge, il serait judicieux de choisir une stratégie commerciale basée sur la promotion de produits vendus en magasin afin de les attirer et d'accroitre leur consommation et par conséquent les profits de l'entreprise.


## Revenu compris [45000;65000]
À l’aide du tableau de taux de participation, on observe 637 consommateurs observés avec un revenu compris entre 45000 et 65000 dans notre base de données.
```{r}
tab_participation <- rbind(table(data[,29]),round((table(data[,29])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction du revenu",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.
```{r}
tab <-t(table(data$NumDealsPurchases[data$Revenu=="45000-65000"])) 
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Revenu=="45000-65000" & data$NumDealsPurchases!=0)/sum(data$Revenu=="45000-65000"))*100,3)`% des consommateurs observés avec un revenu compris entre 45000 et 65000 effectuent des achats remisés. 
Regardons maintenant, en moyenne, parmi les consommateurs observés avec un revenu compris entre 45000 et 65000 ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Revenu=="45000-65000"&
data$AcceptedCmp1==1)/sum(data$Revenu=="45000-65000"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Revenu=="45000-65000"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Revenu=="45000-65000"&
data$AcceptedCmp2==0)
trois <- sum(data$Revenu=="45000-65000"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Revenu=="45000-65000"&
data$AcceptedCmp3==0)
quatre <- sum(data$Revenu=="45000-65000"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Revenu=="45000-65000"&
data$AcceptedCmp4==0)
cinq <- sum(data$Revenu=="45000-65000"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Revenu=="45000-65000"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Revenu4565_disc <-cbind(col2,col1)
Revenu4565_disc2 <- cbind(Revenu4565_disc,col3)
colnames(Revenu4565_disc2) = c("Numéro de campagne","%","% cummulés")


Revenu4565_disc2 %>%
kable(caption = "Comportement des consommateurs observés ayant un revenu compris entre 45000 et 65000 face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ, 21% des consommateurs observés avec un revenu compris entre 45000 et 65000 effectuant des achats remisés acceptent une offre d'achat lors des 5 premières campagnes de remises.Seulement, `r round(sum(data$Revenu=="45000-65000" & data$Response==1)/sum(data$Revenu=="45000-65000")*100,3)` % des consommateurs observés avec un revenu compris entre 45000 et 65000 effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Revenu=="45000-65000"]), sum(data$NumCatalogPurchases[data$Revenu=="45000-65000"]), sum(data$NumStorePurchases[data$Revenu=="45000-65000"]),sum(data$NumWebVisitsMonth[data$Revenu=="45000-65000"]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés avec un revenu compris entre 45000 et 65000",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs avec un revenu compris entre 45000 et 65000, on remarque que le nombre total d'achats effectués en magasin est plus important.


<p class="content">Conclusion :</p>
Pour ce qui est des consommateurs observés avec un revenu compris entre 45000 et 65000, il serait judicieux de choisir une stratégie commerciale basée sur une campagne de publicité promotionnelle des produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.


## Revenu compris [65000;80000]
À l’aide du tableau de taux de participation on observe 457 consommateurs observés avec un revenu compris entre 65000 et 80000 dans notre base de données.

```{r}
tab_participation <- rbind(table(data[,29]),round((table(data[,29])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction du revenu",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.

```{r}
tab <-t(table(data$NumDealsPurchases[data$Revenu=="65000-80000"])) 
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Revenu=="65000-80000" & data$NumDealsPurchases!=0)/sum(data$Revenu=="65000-80000"))*100,3)`% des consommateurs observés ayant un revenu compris entre 65000 et 80000 effectuent des achats remisés. Regardons maintenant, en moyenne, parmi les consommateurs observés avec un revenu compris entre 65000 et 80000 ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Revenu=="65000-80000"&
data$AcceptedCmp1==1)/sum(data$Revenu=="65000-80000"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Revenu=="65000-80000"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Revenu=="65000-80000"&
data$AcceptedCmp2==0)
trois <- sum(data$Revenu=="65000-80000"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Revenu=="65000-80000"&
data$AcceptedCmp3==0)
quatre <- sum(data$Revenu=="65000-80000"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Revenu=="65000-80000"&
data$AcceptedCmp4==0)
cinq <- sum(data$Revenu=="65000-80000"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Revenu=="65000-80000"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Revenu6580_disc <-cbind(col2,col1)
Revenu6580_disc2 <- cbind(Revenu6580_disc,col3)
colnames(Revenu6580_disc2) = c("Numéro de campagne","%","% cummulés")



Revenu6580_disc2 %>%
kable(caption = "Comportement des consommateurs observés ayant un revenu compris entre 65000 et 80000 à charge face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ, 37% des consommateurs observés avec un revenu compris entre 45000 et 65000 effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remises.`r round(sum(data$Revenu=="65000-80000" & data$Response==1)/sum(data$Revenu=="65000-80000")*100,3)` % des consommateurs observés avec un revenu compris entre 65000 et 80000 effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Revenu=="65000-80000"]), sum(data$NumCatalogPurchases[data$Revenu=="65000-80000"]), sum(data$NumStorePurchases[data$Revenu=="65000-80000"]),sum(data$NumWebVisitsMonth[data$Revenu=="65000-80000"]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés avec un revenu compris entre 65000 et 80000",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs avec un revenu compris entre 65000 et 80000, on remarque que le nombre total d'achats effectués en magasin est plus important.



<p class="content">Conclusion :</p>
Pour ce qui est des consommateurs observés avec un revenu compris entre 65000 et 80000, il serait judicieux une fois de plus de choisir une stratégie commerciale basée sur une campagne de publicité promotionnelle des produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.


## Revenu compris [80000;700000]
À l’aide du tableau de taux de participation, on observe 217 consommateurs observés avec un revenu compris entre 80000 et 700000 dans notre base de données.

```{r}
tab_participation <- rbind(table(data[,29]),round((table(data[,29])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction du revenu",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.
```{r}
tab <-t(table(data$NumDealsPurchases[data$Revenu=="80000-700000"])) 
rownames(tab)=c("Effectif")
tab %>%
  kable(caption = "Nombre d'achats avec remise",align = "c") %>%
  kable_styling(full_width = FALSE,
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Revenu=="80000-700000" & data$NumDealsPurchases!=0)/sum(data$Revenu=="45000-65000"))*100,3)`% des consommateurs observés avec un revenu compris entre 80000 et 700000 effectuent des achats remisés. Regardons maintenant, en moyenne, parmi les consommateurs observés avec un revenu compris entre 80000 et 700000 ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Revenu=="80000-700000"&
data$AcceptedCmp1==1)/sum(data$Revenu=="80000-700000"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Revenu=="80000-700000"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Revenu=="80000-700000"&
data$AcceptedCmp2==0)
trois <- sum(data$Revenu=="80000-700000"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Revenu=="80000-700000"&
data$AcceptedCmp3==0)
quatre <- sum(data$Revenu=="80000-700000"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Revenu=="80000-700000"&
data$AcceptedCmp4==0)
cinq <- sum(data$Revenu=="80000-700000"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Revenu=="80000-700000"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Revenu80700_disc <-cbind(col2,col1)
Revenu80700_disc2 <- cbind(Revenu80700_disc,col3)
colnames(Revenu80700_disc2) = c("Numéro de campagne","%","% cummulés")



Revenu80700_disc2 %>%
kable(caption = "Comportement des consommateurs observés ayant un revenu compris entre 80000 et 700000 face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ, 98% des consommateurs observés avec un revenu compris entre 80000 et 700000 effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remises.`r round(sum(data$Revenu=="80000-700000" & data$Response==1)/sum(data$Revenu=="80000-700000")*100,3)` % des consommateurs observés avec un revenu compris entre 80000 et 700000 effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Revenu=="80000-700000"]), sum(data$NumCatalogPurchases[data$Revenu=="80000-700000"]), sum(data$NumStorePurchases[data$Revenu=="80000-700000"]),sum(data$NumWebVisitsMonth[data$Revenu=="80000-700000"]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés avec un revenu compris entre 80000 et 700000",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs avec un revenu compris entre 80000 et 700000, on remarque que le nombre total d'achats effectués en magasin est plus important.


<p class="content">Conclusion :</p>
Pour ce qui est des consommateurs observés avec un revenu compris entre 80000 et 7000000, il serait judicieux de choisir une stratégie commerciale basée sur une campagne de visibilité (par la publicité) des produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.


## Sans adolescent à charge
À l’aide du tableau de taux de participation, on observe 1144 consommateurs observés sans adolescent à charge dans notre base de données.

```{r}
tab_participation <- rbind(table(data[,6]),round((table(data[,6])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction de Teenhome",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.
```{r}
t(table(data$NumDealsPurchases[data$Teenhome==0])) %>%
  kable(caption = "Nombre d'achats avec remise",align = "c") %>%
  kable_styling(full_width = FALSE,
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Teenhome==0 & data$NumDealsPurchases!=0)/sum(data$Teenhome==0))*100,3)`% des consommateurs observés sans adolescent à charge effectuent des achats remisés. Regardons maintenant, en moyenne, parmi les consommateurs observés sans adolescent à charge ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Teenhome==0&
data$AcceptedCmp1==1)/sum(data$Teenhome==0&
data$AcceptedCmp1==0)*100
deux <- sum(data$Teenhome==0&
data$AcceptedCmp2==1)*(100-un)/sum(data$Teenhome==0&
data$AcceptedCmp2==0)
trois <- sum(data$Teenhome==0&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Teenhome==0&
data$AcceptedCmp3==0)
quatre <- sum(data$Teenhome==0&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Teenhome==0&
data$AcceptedCmp4==0)
cinq <- sum(data$Teenhome==0&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Teenhome==0&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Teenhome0_disc <-cbind(col2,col1)
Teenhome0_disc2 <- cbind(Teenhome0_disc,col3)
colnames(Teenhome0_disc2) = c("Numéro de campagne","%","% cummulés")



Teenhome0_disc2 %>%
kable(caption = "Comportement des consommateurs observés sans adolescent à charge face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ, 37% des consommateurs observés sans adolescent à charge effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remises. `r round(sum(data$Teenhome==0 & data$Response==1)/sum(data$Teenhome==0)*100,3)` % des consommateurs observés sans adolescent à charge effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Teenhome==0]), sum(data$NumCatalogPurchases[data$Teenhome==0]), sum(data$NumStorePurchases[data$Teenhome==0]),sum(data$NumWebVisitsMonth[data$Teenhome==0]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés sans adolescent à charge",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs sans adolescent à charge, on remarque que le nombre total d'achats effectués en magasin est plus important.



<p class="content">Conclusion :</p>
 Pour ce qui est des consommateurs observés sans adolescent à charge, il serait judicieux une fois encore de choisir une stratégie commerciale basée sur la promotion de produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.
 
 
## Deux adolescents à charge
À l’aide du tableau de taux de participation, on observe 51 consommateurs observés avec deux adolescents à charge dans notre base de données.

```{r}
tab_participation <- rbind(table(data[,6]),round((table(data[,6])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction de Teenhome",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.
```{r}
t(table(data$NumDealsPurchases[data$Teenhome==2])) %>%
kable(caption = "Nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Teenhome==2 & data$NumDealsPurchases!=0)/sum(data$Teenhome==2))*100,3)`% des consommateurs observés avec deux adolescents à charge effectuent des achats remisés. Regardons maintenant, en moyenne, parmi les consommateurs observés avec deux adolescents à charge ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Teenhome==2&
data$AcceptedCmp1==1)/sum(data$Teenhome==2&
data$AcceptedCmp1==0)*100
deux <- sum(data$Teenhome==2&
data$AcceptedCmp2==1)*(100-un)/sum(data$Teenhome==2&
data$AcceptedCmp2==0)
trois <- sum(data$Teenhome==2&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Teenhome==2&
data$AcceptedCmp3==0)
quatre <- sum(data$Teenhome==2&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Teenhome==2&
data$AcceptedCmp4==0)
cinq <- sum(data$Teenhome==2&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Teenhome==2&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")


col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Teenhome2_disc <-cbind(col2,col1)
Teenhome2_disc2 <- cbind(Teenhome2_disc,col3)
colnames(Teenhome2_disc2) = c("Numéro de campagne","%","% cummulés")



Teenhome0_disc2 %>%
kable(caption = "Comportement des consommateurs observés ayant deux adolescents à charge face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ, 37% des consommateurs observés avec deux adolescents à charge effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remises. Seulement`r round(sum(data$Teenhome==2 & data$Response==1)/sum(data$Teenhome==2)*100,3)` % des consommateurs observés avec deux adolescents à charge effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Teenhome==2]), sum(data$NumCatalogPurchases[data$Teenhome==2]), sum(data$NumStorePurchases[data$Teenhome==2]),sum(data$NumWebVisitsMonth[data$Teenhome==2]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs observés avec deux adolescents à charge",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs avec deux adolescents à charge, on remarque que le nombre total d'achats effectués en magasin est plus important.


<p class="content">Conclusion :</p>
 Pour ce qui est des consommateurs observés avec deux adolescents à charge, il serait judicieux de choisir une stratégie commerciale basée sur une campagne promotionnelle de produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.
 
 
## Veufs

On a vu avec le taux de participation qu'ils étaient 76 dans la base de données.

```{r}
tab_participation <- rbind(table(data[,3]),round((table(data[,3])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction de l'état civil",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.
```{r}
t(table(data$NumDealsPurchases[data$Marital_Status=="Widow"])) %>%
kable(caption = "Nombre d’achats effectués avec remise ",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

`r round((sum(data$Marital_Status=="Widow" & data$NumDealsPurchases!=0)/sum(data$Marital_Status=="Widow"))*100,3)`% des consommateurs observés veufs effectuent des achats remisés. Regardons maintenant, en moyenne, parmi les consommateurs observés veufs ceux qui acceptent une offre d’achat lors d’une campagne de remise.
```{r}
un <- sum(data$Marital_Status=="Widow"&
data$AcceptedCmp1==1)/sum(data$Marital_Status=="Widow"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Marital_Status=="Widow"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Marital_Status=="Widow"&
data$AcceptedCmp2==0)
trois <- sum(data$Marital_Status=="Widow"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Marital_Status=="Widow"&
data$AcceptedCmp3==0)
quatre <- sum(data$Marital_Status=="Widow"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Marital_Status=="Widow"&
data$AcceptedCmp4==0)
cinq <- sum(data$Marital_Status=="Widow"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Marital_Status=="Widow"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Widow_disc <-cbind(col2,col1)
Widow_disc2 <- cbind(Widow_disc,col3)
colnames(Widow_disc2) = c("Numéro de campagne","%","% cummulés")



Widow_disc2 %>%
kable(caption = "Comportement des consommateurs observés veufs face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ 34% des consommateurs observés veufs effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remise. Seulement`r round(sum(data$Marital_Status=="Widow" & data$Response==1)/sum(data$Marital_Status=="Widow")*100,3)` % des consommateurs observés veufs effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Marital_Status=="Widow"]), sum(data$NumCatalogPurchases[data$Marital_Status=="Widow"]), sum(data$NumStorePurchases[data$Marital_Status=="Widow"]),sum(data$NumWebVisitsMonth[data$Marital_Status=="Widow"]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs étant veufs",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs veufs, on remarque que le nombre total d'achats effectués en magasin est plus important.



<p class="content">Conclusion :</p>
 Pour ce qui est des consommateurs observés veufs, il serait judicieux de choisir une stratégie commerciale basée sur campagne de visibilité (par la publicité) des produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.


## Divorcés
On a vu avec le taux de participation qu'ils étaient 232 dans la base de données.

```{r}
tab_participation <- rbind(table(data[,3]),round((table(data[,3])/2209),3))
row.names(tab_participation) <- c("Effectifs","Taux de participation")
tab_participation %>%
  kable(caption = "Taux de participation en fonction de l'état civil",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.

```{r}
t(table(data$NumDealsPurchases[data$Marital_Status=="Divorced"])) %>%
kable(caption = "Nombre d’achats effectués avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
`r round((sum(data$Marital_Status=="Divorced" & data$NumDealsPurchases!=0)/sum(data$Marital_Status=="Divorced"))*100,3)`% des consommateurs observés divorcés effectuent des achats remisés.
Regardons maintenant, en moyenne, parmi les consommateurs observés veufs ceux qui acceptent une offre d’achat lors d’une campagne de remise.

```{r}
un <- sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp1==1)/sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp2==0)
trois <- sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp3==0)
quatre <- sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp4==0)
cinq <- sum(data$Marital_Status=="Divorced"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(
data$Marital_Status=="Divorced"&data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Widow_disc <-cbind(col2,col1)
Widow_disc2 <- cbind(Widow_disc,col3)
colnames(Widow_disc2) = c("Numéro de campagne","%","% cummulés")



Widow_disc2 %>%
kable(caption = "Comportement des consommateurs observés divorcés face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```

Environ 28% des consommateurs observés divorcés effectuant des achats remisés acceptent une offre d’achat lors des 5 premières campagnes de remise. Seulement`r round(sum(data$Marital_Status=="Divorced" & data$Response==1)/sum(data$Marital_Status=="Divorced")*100,3)` % des consommateurs observés divorcés effectuent des achats avec remise lors de la dernière campagne de remise.

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Marital_Status=="Divorced"]), sum(data$NumCatalogPurchases[data$Marital_Status=="Divorced"]), sum(data$NumStorePurchases[data$Marital_Status=="Divorced"]),sum(data$NumWebVisitsMonth[data$Marital_Status=="Divorced"]))

col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")

Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")

Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs étant divorcés",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")

```

Dans le cas des consommateurs divorcés, on remarque que le nombre total d'achats effectués en magasin est plus important.



<p class="content">Conclusion :</p>
Pour ce qui est des consommateurs observés divorcés, il serait judicieux de choisir une stratégie commerciale basée sur campagne promotionnelle des produits vendus en magasin afin d'attirer ces consommateurs et d'accroître leurs consommations et par conséquent les profits de l'entreprise.


## Célibataires 
À l’aide du tableau de taux de participation, on observe 471 consommateurs sont des célibataires.

```{r}
tab_participation <- rbind(table(data[,3]),table(data[,3])/2209)
row.names(tab_participation) <- c("Effectifs","Taux de participation")
round(tab_participation,2) %>%
  kable(caption = "Taux de participation en fonction de l'état civil",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

Observons si ce type de consommateurs à tendance à effectuer des achats remisés.

```{r}
tab <-t(table(data$NumDealsPurchases[data$Marital_Status=="Single"]))
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Effectif des consommateurs observés étant célibataires en fonction du nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
Sur 471 Single, 14 ont acheté leurs achats sans remise. On remarque en général que les célibataires effectuent en général entre 1 et 4 achats avec remise. 
Regardons maintenant, si les consommateurs étant célibataires sont sensibles aux différentes campagnes de remises.

```{r}
un <- sum(data$Marital_Status=="Single"&
data$AcceptedCmp1==1)/sum(data$Marital_Status=="Single"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Marital_Status=="Single"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Marital_Status=="Single"&
data$AcceptedCmp2==0)
trois <- sum(data$Marital_Status=="Single"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Marital_Status=="Single"&
data$AcceptedCmp3==0)
quatre <- sum(data$Marital_Status=="Single"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Marital_Status=="Single"&
data$AcceptedCmp4==0)
cinq <- sum(data$Marital_Status=="Single"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Marital_Status=="Single"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



Single_disc <-cbind(col2,col1)

Single_disc2 <- cbind(Single_disc,col3)
colnames(Single_disc2) = c("Numéro de campagne","%","% cummulés")



Single_disc2 %>%
kable(caption = "Comportement des consommateurs observés célibataires face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
On remarque, que les célibataires ne sont pas très sensibles aux achats selon les différentes remises. En effet, seulement 8 % des célibataires ayant effectués des achats avec remises, font des achats pour la troisième campagne de remise. Le pourcentage d'achats avec remise pour les autres campagnes sont moindres.
Afin, de détailler l'étude et de cibler les clients, nous pouvons regarder le lieux de marché sur lesquelles ceux-ci font leurs achats : 
```{r}
col1 <- c(sum(data$NumWebPurchases[data$Marital_Status=="Single"]), sum(data$NumCatalogPurchases[data$Marital_Status=="Single"]), sum(data$NumStorePurchases[data$Marital_Status=="Single"]),sum(data$NumWebVisitsMonth[data$Marital_Status=="Single"]))



col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")



Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")



Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs étant célibataires",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")
```

Globalement on remarque que les célibataires effectuent plusieurs achats en magasin et en ligne. Cependant, on remarque que par rapport aux autres lieux de marchés, l'achat sur catalogue est moins fréquent. 



Pour conclure, on peut dire que les individus célibataires des clients sont assez sensibles aux achats avec remises. En effet, parmi les clients célibataires `r round((sum(data$Marital_Status=="Single" & data$NumDealsPurchases!=0)/sum(data$Marital_Status=="Single"))*100,2)` % font des achats avec remises. Ces clients, sont affectés par la troisième campagne de remise. Enfin, les célibataires dépensent beaucoup en magasin et sur internet c'est pourquoi il faut privilégier la fidélisation des clients en mettant en place des promotions sur ces lieux de marchés là. 


## Doctorat
À l’aide du tableau de taux de participation on observe 478 consommateurs sont diplômés d'un doctorat.

```{r}
tab_participation <- rbind(table(data[,2]),table(data[,2])/2209)
row.names(tab_participation) <- c("Effectifs","Taux de participation")
round(tab_participation,3) %>%
  kable(caption = "Taux de participation en fonction du niveau d'étude",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```


```{r}
tab <-t(table(data$NumDealsPurchases[data$Education=="PhD"]))
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Effectif des consommateurs observés étant dipômé d'un PhD en fonction du nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))

```
Sur 478 clients ayant un niveau de diplôme PhD (doctorat), 223 personnes effectuent un achat avec remise et 100 personnes effectuent jusqu'à 2 achats avec remises. Au-delà de ces nombres d'achats, l'effectif de personnes effectuant des achats avec remise diminue. 

```{r}
un <- sum(data$Education=="PhD"&
data$AcceptedCmp1==1)/sum(data$Education=="PhD"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Education=="PhD"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Education=="PhD"&
data$AcceptedCmp2==0)
trois <- sum(data$Education=="PhD"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Education=="PhD"&
data$AcceptedCmp3==0)
quatre <- sum(data$Education=="PhD"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Education=="PhD"&
data$AcceptedCmp4==0)
cinq <- sum(data$Education=="PhD"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Education=="PhD"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



phd_disc <-cbind(col2,col1)

phd_disc2 <- cbind(phd_disc,col3)
colnames(phd_disc2) = c("Numéro de campagne","%","% cummulés")



phd_disc2 %>%
kable(caption = "Comportement des consommateurs diplômés d'un PhD face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
On remarque que les parmi les clients doctorants effectuant des achats avec remise, 8.6 % de ceux-ci effectuent des achats lors de la quatrième campagne. Par rapport aux autres campagnes, les clients doctorants, sont plus sensibles à la cette campagne.
Regardons maintenant les lieux de marchés :
 
```{r}
col1 <- c(sum(data$NumWebPurchases[data$Education=="PhD"]), sum(data$NumCatalogPurchases[data$Education=="PhD"]), sum(data$NumStorePurchases[data$Education=="PhD"]),sum(data$NumWebVisitsMonth[data$Education=="PhD"]))



col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")



Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")



Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs diplômés d'un doctorat ",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")


```

Globalement on remarque que les clients diplômés d'un doctorat effectuent plusieurs achats en magasin et en ligne. En effet, le nombre de personnes ayant effectué un achat en ligne au cours du dernier mois reste élevé. Cependant on remarque que par rapport aux autres lieux de marchés, l'achat sur catalogue est moins fréquent.

<br/>

Pour conclure, on peut dire que les clients doctorants sont des clients très sensibles aux remises. En effet sur 478 diplômés d'un PhD, seul  `r round((sum(data$Education=="PhD" & data$NumDealsPurchases!=0)/sum(data$Education=="PhD"))*100,2)` % font des achats avec remises. On remarque que ces clients, sont plus sensibles à la quatrième campagne que les autres. Au niveau des lieux de marchés, comme vu avec les célibataires, les docteurs achètent plus en ligne et en magasin que sur le catalogue. Enfin, le nombre d'achats par mois en ligne est maintenu sur la période. C'est pourquoi il faut privilégier les promotions de type quatrième campagne, la vente en boutique et la fidélisation des clients via le site internet de l'entreprise.


## Graduation

À l’aide du tableau de taux de participation, on observe 1114 consommateurs ont un diplôme Graduation.

```{r}
tab_participation <- rbind(table(data[,2]),table(data[,2])/2209)
row.names(tab_participation) <- c("Effectifs","Taux de participation")
round(tab_participation,3) %>%
  kable(caption = "Taux de participation en fonction du niveau d'étude",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

```{r}
tab <-t(table(data$NumDealsPurchases[data$Education=="Graduation"]))
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Effectif des consommateurs observés étant diplomé d'un Graduation en fonction du nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
On remarque les clients dotés d'un diplôme Graduation sont affectés par le nombre d'achats avec remise. En effet sur 43 % des personnes diplômés font 1 achat en ligne, et 22 % font 2 achats en ligne. Au total sur les personnes diplômées, `r round((sum(data$Education=="Graduation" & data$NumDealsPurchases!=0)/sum(data$Education=="Graduation"))*100,2)` % font des achats avec remise. 

```{r}
un <- sum(data$Education=="Graduation"&
data$AcceptedCmp1==1)/sum(data$Education=="Graduation"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Education=="Graduation"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Education=="Graduation"&
data$AcceptedCmp2==0)
trois <- sum(data$Education=="Graduation"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Education=="Graduation"&
data$AcceptedCmp3==0)
quatre <- sum(data$Education=="Graduation"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Education=="Graduation"&
data$AcceptedCmp4==0)
cinq <- sum(data$Education=="Graduation"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Education=="Graduation"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



grad_disc <-cbind(col2,col1)

grad_disc2 <- cbind(grad_disc,col3)
colnames(grad_disc2) = c("Numéro de campagne","%","% cummulés")



grad_disc2 %>%
kable(caption = "Comportement des consommateurs diplômés d'un Graduation face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
On remarque que 7,6 % des diplômés d'un dipolôme Graduation et effectuant des achats avec remise, effectuent des achats lors de la première campagne.  
Au total 29 % des diplômés effectuant des achats avec remises, effectuent des soldes jusqu'à la cinquième campagne. 
Regardons maintenant les lieux de marchés :

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Education=="Graduation"]), sum(data$NumCatalogPurchases[data$Education=="Graduation"]), sum(data$NumStorePurchases[data$Education=="Graduation"]),sum(data$NumWebVisitsMonth[data$Education=="Graduation"]))



col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")



Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")



Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs diplômés d'un Graduation",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")



```

Globalement on remarque que les clients d'un niveau de diplôme Graduation, effectuent des achats sur tous les marchés. Enfin, on remarque que le nombre total d'achats en magasin reste quand même plus élevé que les achats en ligne, même si le nombre de visite sur le site web de l'entreprise reste très élevée au cours du dernier mois.

<br/>

Pour conclure, on peut dire que les individus diplômés d'un niveau Graduation sont très affectés par les achats avec remises, surtout pour la première affecté par la première campagne de remise. Mais notamment sont nombreux à achetés en magasin, puis en ligne. 


## 2n Cycle
À l’aide du tableau de taux de participation, on observe 200 consommateurs observés étant célibataires.

```{r}
tab_participation <- rbind(table(data[,2]),table(data[,2])/2209)
row.names(tab_participation) <- c("Effectifs","Taux de participation")
round(tab_participation,3) %>%
  kable(caption = "Taux de participation en fonction du niveau d'étude",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

```{r}
tab <-t(table(data$NumDealsPurchases[data$Education=="2n Cycle"]))
rownames(tab)=c("Effectif")
tab %>%
kable(caption = "Effectif des consommateurs observés étant diplomé d'un 2nd Cycle en fonction du nombre d'achats avec remise",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) 
```
Parmi les étudiant diplômés d'un 2n Cycle, `r round((sum(data$Education=="2n Cycle" & data$NumDealsPurchases!=0)/sum(data$Education=="2n Cycle"))*100,2)` % effectuent des achats avec remises. En effet, on remarque que 143 personnes font au plus 1 achat avec remise. 

```{r}
un <- sum(data$Education=="2n Cycle"&
data$AcceptedCmp1==1)/sum(data$Education=="2n Cycle"&
data$AcceptedCmp1==0)*100
deux <- sum(data$Education=="2n Cycle"&
data$AcceptedCmp2==1)*(100-un)/sum(data$Education=="2n Cycle"&
data$AcceptedCmp2==0)
trois <- sum(data$Education=="2n Cycle"&
data$AcceptedCmp3==1)*(100-(un+deux))/sum(data$Education=="2n Cycle"&
data$AcceptedCmp3==0)
quatre <- sum(data$Education=="2n Cycle"&
data$AcceptedCmp4==1)*(100-(un+deux+trois))/sum(data$Education=="2n Cycle"&
data$AcceptedCmp4==0)
cinq <- sum(data$Education=="2n Cycle"&
data$AcceptedCmp5==1)*(100-(un+deux+trois+quatre))/sum(data$Education=="2n Cycle"&
data$AcceptedCmp5==0)



col1 <- c(round(un,3),round(deux,3),round(trois,3),round(quatre,3),round(cinq,3))



col2 <- c("Offre acceptée lors de la première campagne de remise", "Offre acceptée lors de la deuxième campagne de remise", "Offre acceptée lors de la troisième campagne de remise", "Offre acceptée lors de la quatrième campagne de remise","Offre acceptée lors de la cinquième campagne de remise")



col3 <- c(round(un,3),round(un+deux,3),round(un+deux+trois,3),round(un+deux+trois+quatre,3),
round(un+deux+trois+quatre+cinq,3))



cycle_disc <-cbind(col2,col1)

cycle_disc2 <- cbind(cycle_disc,col3)
colnames(cycle_disc2) = c("Numéro de campagne","%","% cummulés")



cycle_disc2 %>%
kable(caption = "Comportement des consommateurs diplômés d'un 2nd Cycle face aux promotions",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed"))
```
Ce tableau nous montre que les clients diplômés d'un 2n Cycle et effectuant des achats avec remises, sont plus sensibles aux premières et troisième campagne. En effet, 7.53 % de ceux-ci font des achats pour la première campagne de remise, et 7.42 % pour la troisième campagne. 
Regardons maintenant, les différentes lieux de marchés sur lesquelles ces clients font leurs achats : 

```{r}
col1 <- c(sum(data$NumWebPurchases[data$Education=="2n Cycle"]), sum(data$NumCatalogPurchases[data$Education=="2n Cycle"]), sum(data$NumStorePurchases[data$Education=="2n Cycle"]),sum(data$NumWebVisitsMonth[data$Education=="2n Cycle"]))



col2 <- c("Achats sur site web", "Achats sur catalogue", "Achats en magasin", "Visites du site web durant le dernier mois")



Achats <- cbind(col1,col2)
colnames(Achats) = c("Nombre d'achats total", "Lieux de vente")



Achats %>%
kable(caption = "Achats en fonction des lieux de vente pour les consommateurs diplômés d'un 2n Cycle",align = "c") %>%
kable_styling(full_width = FALSE,
position = "center",
bootstrap_options = c("hover","striped","condensed")) %>% row_spec(3, background = "#fcae91")
```

Globalement on remarque que les achats en magasin sont plus fréquents pour clients ayant un niveau de diplôme 2n Cycle.  

<br/>

Conclusion, les clients dotés d'un diplôme de 2n Cycle, sont affectés par les remises, particulièrement par la première et troisème campagne de remise. De plus, ils effectuent en général plus d'achats en boutique que sur le site ou sur le catalogue de l'entreprise. 

# Dépendance
Les consommateurs cibles de notre étude sont : **Divorced**, **Widow**, **Single**, **PhD**,**Graduation**,**2n Cycle**, **0 enfant**, **2 adolescents**,**0 adolescent** et **gros revenu**. Il serait interessant de regarder la corrélation de certaines de ces variables pour affirmer ou infirmer nos hypothèses. Par exemple, on peut émettre l'hypothèse que les consommateurs avec un gros revenu possèdent un diplôme ***PhD*** ou ***Graduation***.

## Matrice de corrélation (quantitatives)
Nos variables ***Education*** et ***Marital_Statuts*** sont des variables qualitatives. Regardons la matrice de corrélation sur notre base de données sans ces deux variables :
```{r,fig.align="center"}
basetest <- data
basetest$Kidhome <- as.numeric(data$Kidhome)
basetest$Teenhome <- as.numeric(data$Teenhome)
basetest$Revenu <- as.numeric(data$Revenu)

dataCOR <- data[,c(5,6,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,28,29)]
dataCOR$Kidhome <- as.numeric(data$Kidhome)
dataCOR$Teenhome <- as.numeric(data$Teenhome)
dataCOR$Revenu <- as.numeric(data$Revenu)
M <- cor(dataCOR)
col<- colorRampPalette(c("#F5B9B9","#E31F1F", "#6B0C0C"))(8)
corrplot(M, type="upper", order="hclust", col=col,tl.col="black")
```
On remarque que les dépenses en consommation de produits sont corrélées entre elles, avec les lieux de marchés et le revenu. On voit également la relation décroissante entre le nombre d'enfants et la dépense en consommation. Ce qui concorde bien avec nos résultats précédents.

## Rapport de corrélation (quanti-quali)
Calculons le rapport de corrélation entre des variables quantitatives et qualitatives. Pour cela, on étudie la variabilité de la variable quantitative induit par les modalités (les différentes classes) de la variable qualitative. On calcule alors, la variance totale de notre variable quantitative et la variance inter-groupe pour obtenir le rapport de corrélation, $\eta^2$ :
```{r}
vartot <- function(x) {res <- sum((x-mean(x))^2) ; return(res)}

varinter <- function(x,gpe) {
moyennes <- tapply(x,gpe,mean)
effectifs <- tapply(x,gpe,length)
res <- (sum(effectifs*(moyennes-mean(x))^2))
return(res)
}

eta2 <- function(x,gpe) {res <- varinter(x,gpe)/vartot(x) ; return(res)}
```

- **Hypothèse :** Les consommateurs avec un revenu élevé sont-ils liés avec les consommateurs de niveau d'étude élevé ?

L'indicateur est `r round(eta2(basetest$Revenu,basetest$Education),4)`, il est plus proche de 0 que de 1. Donc, ces variables ne sont pas liées.

<br/>

- **Hypothèse :** Les consommateurs avec un nombre d'enfant élevé sont-ils liés avec certaines modalités de l'état civil ?

L'indicateur est `r round(eta2(basetest$Kidhome,basetest$Marital_Status),4)`, il est plus proche de 0 que de 1. Donc, ces variables ne sont pas liées.

<br/>

- **Hypothèse :** Les consommateurs avec un nombre d'adolescents élevé sont-ils liés avec certaines modalités de l'état civil ?

L'indicateur est `r round(eta2(basetest$Teenhome,basetest$Marital_Status),4)`, il est plus proche de 0 que de 1. Donc, ces variables ne sont pas liées.


## $\chi^2$ (qualitatives)
```{r}
tab <- table(data$Education, data$Marital_Status)



K <- chisq.test(tab)



col1 <- c(round(K$statistic,3),round(K$p.value,3))
col2 <- c("$\\chi^2_{obs}$","$p.value$")
result <- cbind(col2,col1)
colnames(result) <- c("","")
rownames(result) <- c("","")



result %>% kable() %>% kable_styling()
```
La p.value est supérieure au risque de première espèce (5%) donc on conserve l'hypothèse d’indépendance des lignes et des colonnes du tableau de contingence. Donc les variables ***Education*** et ***Marital_Status*** ne sont pas liées. Regardons quand même si nos modalités ne sont pas sûr ou sous représentées :
```{r}
mosaicplot(tab, las = 1, shade = TRUE,main = "Représentation du tableau croisé")
```
Comme les résidus du test appartiennent tous à $[-2;2]$, aucune de nos modalités sont sûr ou sous représentées.



# Analyse par Composantes Principales
Nous allons procéder a une ACP (Analyse par Composantes Principales), pour cela il est nécessaire d'enlever toutes les variables qualitatives du dataframe.
```{r}
resacp <- PCA(dataCOR,graph=F)
```

## Etudes des inerties
Recherchons les axes qui permettent d'observer la population en conservant un maximum de dispersion.
```{r}
TabIne<-round(t(resacp$eig),1)
rownames(TabIne)<-c("Inerties","Inerties relatives %","Inerties relatives cumulées")
colnames(TabIne)<-1:nrow(resacp$eig)
write.table(TabIne,"TabIne.txt",sep=";",dec=",",eol="\n",quote=F)

TabIne %>% kable(caption = "",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
On peux voir que la valeur propre de la $5^{ème}$ dimension est de 0.9, ce qui est inférieur à 1 donc on ne le conserve pas. Et comme la $4^{ème}$ dimension a une valeur propre proche de 1, on ne s'y intéresse pas également car elle n’apporte pas d’informations supplémentaire.


Ici, la $1^{ère}$ dimension nous permet de voir 33.2%% des variables donc on la conserve. Cependant, les axes factoriels 2 et 3 ne nous permettent pas de voir beaucoup plus d’informations. Il serait judicieux de regrouper des variables entre elles, comme les variables associées aux campagnes de remise et celles associées au nombre de mineurs dans un foyer.

```{r}
# mineurs
dataCOR2 <- dataCOR
dataCOR2$Mineurs <- NA
dataCOR2$Mineurs <- dataCOR$Teenhome + dataCOR$Kidhome
dataCOR2 <- dataCOR2[,-c(1,2)]
```

```{r}
# Promotions
dataCOR2$Promotions <- NA
dataCOR2$Promotions <- dataCOR$AcceptedCmp1 + dataCOR$AcceptedCmp2 + 
  dataCOR$AcceptedCmp3 + dataCOR$AcceptedCmp4 + dataCOR$AcceptedCmp5 + dataCOR$Response
dataCOR2 <- dataCOR2[,-c(12:17)]
```


<p class="content">Nouvelles inerties :</p>
```{r}
resacp2 <- PCA(dataCOR2,graph=F)
```

```{r}
TabIne<-round(t(resacp2$eig),1)
rownames(TabIne)<-c("Inerties","Inerties relatives %","Inerties relatives cumulées")
colnames(TabIne)<-1:nrow(resacp2$eig)
write.table(TabIne,"TabIne.txt",sep=";",dec=",",eol="\n",quote=F)

TabIne %>% kable(caption = "",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
Les valeurs propres des deux premiers axes factoriels permettent de voir 56.7% des variables, ce qui en montre plus que les 3 axes dans le cas précédent.


<p class="content">Représentation graphique :</p>
```{r}
fviz_screeplot(resacp2,
               geom = c("bar", "line"),
               barfill = "#F8F5F0",
               barcolor = "#ABA37F",
               linecolor = "grey",
               addlabels = TRUE,
               main = "Diagrammes des interties",
               xlab = "Axes factoriels",
               ylab = "Pourcentage de variances",
               ggtheme = theme_minimal(),) +
    geom_point(shape=19, color="#B21515", fill="#B21515",alpha=0.8, size=3) 
```
Un effet de coude est visible sur ce diagramme, on va donc garder les deux premiers axes factoriels car les suivants ne permettent pas de distinguer suffisemment les individus. 


## Etudes des variables

### Informations sur les variables
Ci-dessous, le tableau des coordonnées, des qualités de représentation et des contributions des variables : 
```{r}
#Coordonnées
CoordVar<-round(resacp2$var$coord[,1:2],2) 
#Qualité de représentation
QualF1F2<-resacp2$var$cos2[,1]+resacp2$var$cos2[,2]
QualF1<-resacp2$var$cos2[,1]
QualF2<-resacp2$var$cos2[,2]
#Contributions
ctrF1var <- resacp2$var$contrib[,1]
ctrF2var <- resacp2$var$contrib[,2]

Tab <- cbind(CoordVar,round(ctrF1var,3),
             round(ctrF2var,3),round(QualF1,3),round(QualF2,3),round(QualF1F2,3))
colnames(Tab)<-c("F1","F2","contribution($F_1$)","contribution($F_2$)","Qualité($F_1$)","Qualité($F_2$)","Qualité($F_1,F_2$)")

Tab %>% kable(caption = "",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
On remarque que les promotions sont mal représentées sur les deux axes factoriels, la qualité de représentation étant égale à 0.183.

<p class="content">Pour l'axe $F_1$ les variables contributives sont :</p>
- Revenu 10.701%,
- NumCatalogPurchases 10.716%,
- MntMeatProducts 10.705%

Ces trois variables expliquent 32,122% de l’axe $F_1$. Il regroupe des revenus, un nombre d'achats sur catalogue et des dépenses en viande élevés.

<p class="content">Pour l'axe $F_2$ les variables contributives sont :</p>

- NumDealsPurchases 38.661%,
- NumWebPurchases 21.343%,
- Mineurs 12.296%

Ces trois variables expliquent 72.3% de l’axe $F_2$. Il regroupe le nombre d'achats remisés, le nombre d'achats sur internet et le nombre de mineurs dans le foyer.

<p class="content">On peut le voir graphiquement :</p>
```{r}
fviz_contrib(resacp2, choice = "var", axes = 1,
             fill = "#F8F5F0",
             color = "#ABA37F") +
    ggtitle("Contribution des variables à l'axe 1") 
```

```{r}
fviz_contrib(resacp2, choice = "var", axes = 2,
             fill = "#F8F5F0",
             color = "#ABA37F")  +
    ggtitle("Contribution des variables à l'axe 2") 
```


### Nuage des variables
```{r}
fviz_pca_var(resacp2,repel=T,col.var = "contrib", title="Nuage des variables sur le plan (F1,F2)",
             gradient.cols = c("#F5B9B9","#E31F1F", "#6B0C0C"),ggtheme = theme_minimal())
```
Comme vu précédemment, ce sont les mêmes variables qui contribuent le plus aux axes $F_1$ et $F_2$. On voit également les fortes corrélations entre certaines variables. Par exemple, **Mineurs** s'apparente à **NumWebVisitsMonth**, on peut en déduire que le nombre visites sur le site Web augmente avec le nombre de mineurs dans un foyer. Ou encore, **MntWineProducts** s'apparente à **NumStorePurchases**, on peut en déduire que la dépense en vin s'effectue surtout en magasin. Enfin, **Revenu** s'apparente à **NumCataloguePurchases**, ce qui signifie que les consommateurs avec un revenus élevés achètent sur catalogue.

<p class="content">Interprétations des axes : </p>
- Axe $F_1$ : Les revenus élevés sont associés à une dépense en viande importante et un nombre d'achats sur catalogue conséquent. En effet, les biens accessibles à la vente sur catalogue sont des biens ''convoités'' qui sont la plupart du temps onéreux. Ce qui coïncide avec des revenus élevés.
- Axe $F_2$ : Les familles nombreuses sont davantage susceptible d'acheter des produits remisés, d'effectuer des achats sur internet et de faire, en amont de l'achat, des recherches sur internet. On peut déduire que ces consommateurs comparent ou attendent que le prix de l'article baisse. 


## Etudes des consommateurs
```{r}
fviz_pca_ind(resacp2, geom = "point", title="Nuage des individus sur le plan F1,F2 (PCA)",
             col.ind = "cos2", gradient.cols = c("white","#E31F1F", "#6B0C0C"))
```
On remarque que les individus qui contribuent le plus à la construction des axes sont globalement les consommateurs les mieux représentés. Il est donc intéressant de cibler notre analyse sur ces consommateurs. On voit notamment un groupement conséquent d'individus dans le quart de plan négatif. Si on se fit a notre interprétation des axes, ces individus ont des revenus plus faible que la moyenne
et ne sont pas des familles nombreuses.


# Analyse Factorielle des Correspondances

## Choix des variables
La réalisation d'une AFC nécessite l'utilisation de deux variables qualitatives ou bien d'une variable qualitative et d'une variable quantitative regroupée en classes. Dans notre étude, plusieurs couples de variables seraient intéressant à étudier. Notamment, l'étude de la variable **Revenu**, qui est la variable quantitative **Income** regroupée en classe, avec une variable qualitative. Voici la liste des variables candidates de notre base de données pour une AFC :

- **Education**
- **Marital_Status**
- **Revenu**

Pour effectuer une AFC il faut qu'il existe une liaison entre les deux variables choisies, puisque l'objectif de l'AFC est de visualiser la nature de cette liaison.

### Niveau d'étude et état civil
```{r}
dataEM<-table(data$Education, data$Marital_Status)
```

```{r}
dataEM %>% kable(caption = "Tableau de contingence",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

<p class="content">Test du $\chi^2$</p>
```{r}
K <- chisq.test(dataEM)

col1 <- c(round(K$statistic,3),round(K$p.value,3))
col2 <- c("$\\chi^2_{obs}$","$p.value$")
result <- cbind(col2,col1)
colnames(result) <- c("","")
rownames(result) <- c("","")


result %>% kable() %>% kable_styling()
```
Le test du $\chi^2$ nous permet de conclure à l'indépendance de ces deux variables.

### Niveau d'étude et revenu
```{r}
dataER<-table(data$Education, data$Revenu)
```

```{r}
dataER %>% kable(caption = "Tableau de contingence",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

<p class="content">Test du $\chi^2$</p>
```{r}
K <- chisq.test(dataER)

col1 <- c(round(K$statistic,3),(K$p.value))
col2 <- c("$\\chi^2_{obs}$","$p.value$")
result <- cbind(col2,col1)
colnames(result) <- c("","")
rownames(result) <- c("","")

result %>% kable() %>% kable_styling()
```
Le test du $\chi^2$ nous permet de conclure à une liaison de ces deux variables. Après avoir effectué une analyse factorielle sur celles-ci, nous avons conclu qu'elles n'étaient pas intéressantes à étudier puisque toute l'information est concentrée sur un seul axe factoriel (94.5% de l'inertie). 


### État civil et revenu
```{r}
dataMR<-table(data$Marital_Status, data$Revenu)
```

```{r}
dataMR %>% kable(caption = "Tableau de contingence",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

<p class="content">Test du $\chi^2$</p>
```{r}
K <- chisq.test(dataMR)

col1 <- c(round(K$statistic,3),(K$p.value))
col2 <- c("$\\chi^2_{obs}$","$p.value$")
result <- cbind(col2,col1)
colnames(result) <- c("","")
rownames(result) <- c("","")

result %>% kable() %>% kable_styling()
```
Le test du $\chi^2$ nous permet de conclure à une liaison entre ces deux variables. Cepandant, après avoir effcectué une analyse factorielle sur celles-ci, nous avons remarqué que cette analyse n'était pas pertinente puisque les variables associées n'ont pas forcément un sens. Pour illustrer nos dires, nous pouvons visualiser l'étude simultanée :

```{r}
resAFC<-CA(dataMR, graph = FALSE)

fviz_ca_biplot(resAFC,repel = TRUE, alpha.col = 4, col.col = "#a50f15", col.row = "#fc9272")
```


### Revenu et dépense totale
A présent, nous décidons de créer une nouvelle variable **Dépense** représentant la dépense totale (tous produits confondus) des consommateurs. Cette AFC sera donc réalisée avec deux variables quantitatives transformées en variables catégorielles. 

```{r}
data<-data %>% mutate(Dépense= MntWines + MntFruits + MntMeatProducts + MntFishProducts + MntSweetProducts + MntGoldProds)
```

```{r}
data$Dépense<-cut(data$Dépense, c(5,320,635,950,1265,1580,1895,2210,2525), include.lowest = TRUE, 
              labels = c("5-320", "320-635", "635-950", "950-1265",
                         "1265-1580","1580-1895","1985-2210","2210-2525"),dig.lab = 0)
```

```{r}
dataDR<-table(data$Dépense, data$Revenu)
```

```{r}
dataDR %>% kable(caption = "Tableau de contingence",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

<p class="content">Test du $\chi^2$</p>
```{r}
K <- chisq.test(dataDR)

col1 <- c(round(K$statistic,3),(K$p.value))
col2 <- c("$\\chi^2_{obs}$","$p.value$")
result <- cbind(col2,col1)
colnames(result) <- c("","")
rownames(result) <- c("","")

result %>% kable() %>% kable_styling()
```
Le test du $\chi^2$ nous permet de conclure à une liaison entre ces deux variables.

## Tableaux de profils
<p class="content">Contributions au $\chi^2$</p>
```{r}
round(K$residuals^2,1) %>% addmargins() %>%
  kable(caption = "Tableau des contributions au Khi-2",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
Le tableau des contributions ci-dessus nous permet d'appuyer le résultat du test du $\chi^2$. Cela nous permet de voir que certaines modalités colonnes sont corrélées avec certaines modalités lignes : 
<p/>
En général, chaque ligne et chaque colonne contribuent significativement au modèle. Certaines contributions apparaissent très élevées en comparaison des autres. Par exemple, si on prend la valeur la plus grande ($198.6$), on peut dire que les individus dont la dépense est comprise entre 5 et 320 euros sont soit nombreux, soit très peu à avoir un revenu compris entre 65000 et 80000 euros. Afin de lever cette ambiguïté, observons le tableau des profils-lignes.
 
<p class="content">Tableau des profils lignes :</p>
```{r}
#fonction : calcul du profil
profil <- function(x){x/sum(x)*100}
#profil ligne
prof.ligne <- t(apply(dataDR,1,profil))
round(prof.ligne,2) %>% addmargins() %>%
  kable(caption = "Tableau des Profils lignes",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
On observe une tendance générale. Il y a une corrélation positive entre le revenu et la dépense totale, plus la dépense est importante plus revenu l'est également. En reprenant notre exemple du tableau des contributions au $\chi^2$, nous remarquons que les consommateurs avec les modalités dépense [5;320] et revenu [65000;80000] sont peu nombreux.


<p class="content">Tableau des profils colonnes :</p>
```{r}
prof.colonne <- apply(dataDR,2,profil)
round(prof.colonne,1) %>% addmargins() %>%
  kable(caption = "Tableau des Profils lignes",align ="c") %>%
  kable_styling(full_width = FALSE,
                position ="center",
                bootstrap_options = c("hover","striped","condensed")) %>%
  column_spec(1,bold = T)
```
Globalement, on observe que les individus ayant les revenus les moins élevés ne dépensent pas en quantité. Cependant, l'inverse n'est pas flagrant, lorsque l'on observe les revenus les plus élevés avec une dépense conséquente le lien n'est pas autant marqué.

```{r}
resafc<-CA(dataDR, graph = FALSE)
```

## Études des inerties
```{r}
fviz_screeplot(resafc, 
               geom = c("bar", "line"),
               addlabels = TRUE, 
               barcolor = "#FDC4A8", 
               linecolor = "grey",
               barfill = "#fee5d9", 
               main = "Diagramme des inerties relatives %",
               xlab = "Axes factoriels",
               ylab = "Pourcentage de variances",
               ggtheme = theme_minimal()) +
  geom_hline (yintercept = 16.7, linetype = 2, color = "#B21515") +
    geom_point(shape=19, color="#B21515", fill="#B21515",alpha=0.8, size=3) 
```

La valeur moyenne des axes est égale à `r round((1/(ncol(dataDR)-1))*100,3)`%. Les axes expliquant moins de `r round((1/(ncol(dataDR)-1))*100,3)`% de l'inertie totale seront trop petits pour être conservé pour une analyse plus appronfondie. 
De plus, nous observons un "effet de coude".
Nous conservons donc seulement les axes factoriels 1 et 2.

## Étude des profils colonnes

### Qualité de représentation $F_1$,$F_2$
```{r}
fviz_cos2 (resafc, choice = "col", axes = 1:2, color = "#EA804C", fill = "#fcbba1", title = "Qualité de représentation des colonnes sur les axes factoriels 1 et 2")
```
Une qualité de représentation (*cos2*) proche de 1 correspond à une colonne bien représentée. Dans notre cas, on observe que toutes les colonnes (classes de revenu) sont bien représentées ($cos2 > 0.75$).

### Contributions de $F_1$,$F_2$
```{r}
fviz_contrib(resafc, 
             choice = "col", 
             axes = 1,
             fill = "#fc9272",
             color = "#DA613D") +
    ggtitle("Contribution des colonnes à l'axe 1") 
```

```{r}
fviz_contrib(resafc, 
             choice = "col", 
             axes = 2,
             fill = "#fc9272",
             color = "#DA613D") +
    ggtitle("Contribution des colonnes à l'axe 2") 
```
Les profils colonnes **65000-80000**, **80000-700000** et **45000-65000** sont ceux qui contribuent le plus aux axes factoriels 1 et 2.

### Nuage des profils colonnes
```{r}
fviz_ca_col(resafc, repel = TRUE, col.col = "cos2",
             gradient.cols = c("#fee0d2", "#fc9272", "#de2d26"), title = "Profils colonnes") + 
  geom_path(colour = "#fb6a4a")
```
On remarque qu'aucun profil colonne se rapproche du comportement moyen. On observe que **80000-700000** est le profil colonne s'éloignant le plus du comportement moyen : on parle de modalité rare dans ce cas. 
De plus,  on observe un "effet guttman". Cela signifie que l'axe $F_1$ oppose les revenus extrêmes, tandis que l'axe $F_2$ oppose les revenus moyens aux revenus plutôt extrêmes. L'observation d'un effet guttman n'est pas surprenante ici, puiqu'il existe une structure d’ordre à la fois sur l’ensemble des lignes et sur celui des colonnes et que ces structures sont associées.

## Étude des profils lignes
### Qualité de représentation $F_1$,$F_2$
```{r}
fviz_cos2 (resafc, choice = "row", axes = 1:2, color = "#EA804C", fill = "#fcbba1", title = "Qualité de représentation des colonnes sur les axes factoriels 1 et 2")
```
Une qualité de représentation (*cos2*) proche de 1 correspond à une colonne bien représentée. Dans notre cas, on observe que toutes les colonnes (classes de revenu) sont bien représentées ($cos2 > 0.75$).

### Contributions de $F_1$,$F_2$
```{r}
fviz_contrib(resafc, choice = "row", axes = 1, top = 10, color ="#DA613D", fill = "#fc9272", title = "Contribution des lignes à la diemension 1")
fviz_contrib(resafc, choice = "row", axes = 2, top = 10, color ="#DA613D", fill = "#fc9272", title = "Contribution des lignes à la dimension 2")
```
Le profil colonne contribuant le plus à l'axe $F_1$ est **5-320**. On observe une petite contribution du profil colonne **1265-1580** et une moindre contribution des profils colonnes **950-1265** et **1580-1895**.
Les profils colonnes **320-635**, **635-950** et **1985-2210** sont ceux qui contribuent le plus à l'axe $F_2$.

### Nuage des profils lignes
```{r}
fviz_ca_row(resafc, repel = TRUE, col.row = "cos2",
             gradient.cols = c("#fee0d2", "#fc9272", "#de2d26"), title = "Profils lignes")
```
Dans un premier temps, nous remarquons que l'axe $F_1$ oppose la dépense la plus faible aux autres dépenses.
Ensuite, nous observons que les dépenses moyennes (non extrêmes) opposent les dépenses extrêmes à l'axe $F_2$.

## Étude simultanée 
```{r}
fviz_ca_biplot(resafc, repel = TRUE, alpha.col = 4, col.col = "#a50f15", col.row = "#fc9272") + 
  geom_path(colour = "#fb6a4a")
```
On associe les revenus les plus élevés aux dépenses les plus importantes car ils sont dans le même quart de plan. Cela semble logique puisque un revenu important n'est pas synonyme de dépenses moindres.



# Aanalyse des Correspondances Multiples 

Dans cette partie de l'étude, nous appliquons à notre base de données une Analyse des Correspondances Multiples. Cette analyse suggère une nouvelle modification de la base de données, c'est-à-dire transformer nos variables quantitatives en classes afin de faire une étude sur des données qualitatives. 


<p class="content">Nettoyage de la base :</p>
- Nous avons recodé les variables en ***factor***.
- Nous avons fait des classes pour intégrer les variables quantitatives dans l'étude (années de naissances, achats sur les différents lieux de marchés, dépenses pour les produits..)
- Nous avons également recodé la date d'adhésion des clients.
- Nous avons enlevé les variables inemployées dans notre étude. 

```{r}
base<-data
```
 

```{r}
base$Marital_Status<-as.factor(base$Marital_Status)
base$Education<-as.factor(base$Education)
base$Response<-as.factor(base$Response)
base$Complain<-as.factor(base$Complain)
base$AcceptedCmp1<-as.factor(base$AcceptedCmp1)
base$AcceptedCmp2<-as.factor(base$AcceptedCmp2)
base$AcceptedCmp3<-as.factor(base$AcceptedCmp3)
base$AcceptedCmp4<-as.factor(base$AcceptedCmp4)
base$AcceptedCmp5<-as.factor(base$AcceptedCmp5)
base$Kidhome<-as.factor(base$Kidhome)
base$Teenhome<-as.factor(base$Teenhome)
```

```{r}
#data d'adhésion
base$Dt_Customer<-str_sub(base$Dt_Customer,7,10)
base$Dt_Customer<-as.factor(base$Dt_Customer)
```


```{r}
AchatsRemises<-cut(base$NumDealsPurchases, c(0,4,9,15), include.lowest = TRUE,
                   labels = c("AchatsRemises_0-4", "AchatsRemises_4-9", "AchatsRemises_9-15"),dig.lab = 0)
base<-cbind(base,AchatsRemises)
```


```{r}

AchatsWeb<-cut(base$NumWebPurchases, c(0,8,17,27), include.lowest = TRUE,
                   labels = c("Web_0-8", "Web_8-17", "Web_17-27"),dig.lab = 0)
base<-cbind(base,AchatsWeb)
```

```{r}

AchatsStores<-cut(base$NumStorePurchases, c(0,4,8,13), include.lowest = TRUE,
                   labels = c("Store_0-4", "Store_4-8", "Store_8-13"),dig.lab = 0)
base<-cbind(base,AchatsStores)
```

```{r}
AchatsCatalog<-cut(base$NumCatalogPurchases, c(0,9,19,28),               
                   include.lowest = TRUE,
                   labels = c("Catalog_0-9", "Catalog_9-19","Catalog_19-28"),dig.lab = 0)
base<-cbind(base,AchatsCatalog)
```


```{r}
Webvisit<-cut(base$NumWebVisitsMonth, c(0,6,13,20),
              include.lowest = TRUE,
              labels = c("VisitMonth_0-6", "VisitMonth_6-13", "VisitMonth_13-20"),dig.lab = 0)
base<-cbind(base,Webvisit)
```


```{r}
Year<-cut(base$Year_Birth, c(1893,1927,1961,1996),
                   include.lowest = TRUE,
                   labels = c("Year_1893-1927", "Year_1927-1961", "Year_1961-1996"),dig.lab = 0)
base<-cbind(base,Year)
```

```{r}
Wines<-cut(base$MntWines, c(0,498,996,1494),
                   include.lowest = TRUE,
                   labels = c("Wines_0-498", "Wines_498-996", "Wines_996-1494"),dig.lab = 0)
base<-cbind(base,Wines)
```

```{r}
Fish<-cut(base$MntFishProducts, c(0,87,174,261),
                   include.lowest = TRUE,
                   labels = c("Fish_0-87", "Fish_87-174", "Fish_174-261"),dig.lab = 0)
base<-cbind(base,Fish)

```

```{r}
Meat<-cut(base$MntMeatProducts, c(0,575,1150,1725),
          include.lowest = TRUE,
          labels = c("Meat_0-575", "Meat_575-1150","Meat_1150-1725"),dig.lab = 0)
base<-cbind(base,Meat)

```

```{r}
Fruits<-cut(base$MntFruits, c(0,66,132,200),
                   include.lowest = TRUE,
                   labels = c("Fruits_0-66", "Fruits_66-132","Fruits_132-200"),dig.lab = 0)
base<-cbind(base,Fruits)
```

```{r}
Sweet<-cut(base$MntSweetProducts, c(0,87,174,262),
                   include.lowest = TRUE,
                   labels = c("Sweet_0-87", "Sweet_87-174","Sweet_174-262"),dig.lab = 0)
base<-cbind(base,Sweet)

```


```{r}
Gold<-cut(base$MntGoldProds, c(0,107,214,321),
                   include.lowest = TRUE,
                   labels = c("Gold_0-107", "Gold_107-214","Gold_214-321"),dig.lab = 0)
base<-cbind(base,Gold)

```

```{r}
Jour<-cut(base$Recency, c(0,33,66,99),
                   include.lowest = TRUE,
                   labels = c("Days_0-33", "Days_33-66","Days_66-99"),dig.lab = 0)
base<-cbind(base,Jour)
```


```{r}
## on enlève toutes les variables quanti : 
donnees<-base[,-c(1,4,8,9,10,11,12,13,14,15,16,17,18,19,26,27,30)]
```


## Liens entre variables qualitatives

Nous pouvons observer les liaisons potentielles entre les variables qualitatives. Pour cela, nous avons effectué une matrice représentant les V.Cramer. Il mesure l'intensité de liaison, celui-ci est compris entre $[-1,1]$. 

```{r vcramer}
cv <- function(x, y) {
      t <- table(x, y)
      chi <- suppressWarnings(chisq.test(t))$statistic
      cramer <- sqrt(chi / (length(x) * (min(dim(t)) - 1)))
      cramer
}

cramer.matrix <- function(y, fill = TRUE){
      col.y <- ncol(y)
      V <- matrix(ncol = col.y, nrow = col.y)
      for(i in 1:(col.y - 1)){
            for(j in (i + 1):col.y){
                  V[i,j] <- cv(pull(y,i), pull(y,j))
            }
      }
      diag(V) <- 1 
      if (fill) {
            for (i in 1:ncol(V)) {
                  V[, i] <- V[i, ]
            }
      }
      colnames(V) <- names(y)
      rownames(V) <- names(y)
      V
}
```

```{r}
corrplot(cramer.matrix(donnees), type = "upper", diag = FALSE, tl.col = "black",col=colorRampPalette(c("white","red"))(10))
```

La variable ***Revenu*** en particulier est liée à beaucoup de variables telles que : le nombre d'enfants, la cinquième campagne de remise, les achats en boutique et la dépense en vin. 
De plus, nous remarquons de la liaison pour la cinquième campagne de remise avec la dépense en vin. 
Enfin, nous observons une liaison entre les achats sur catalogue et la dépense en viande. 



## Étude des inerties

```{r}
acm <- MCA(donnees,graph=FALSE, ncp=Inf)
```

```{r}
fviz_screeplot(acm, choice = "variance",
               main ="Diagrammes des inerties relatives %",
               addlabels = TRUE,  ylab=" ", linecolor="black",
               barfill = "#B95945", barcol="#99240C", alpha=0.1) +
  theme_minimal() +
    geom_point(shape=19, color="#99240C", fill="#99240C",alpha=0.8, size=3) 
```

L'inertie d'un axe mesure la liaison entre l'axe et les variables. Ainsi, nous conservons 4 axes puisqu'on observe un "coude" pour le cinquième axe. 
 

## Études des variables 

### Contribution sur $F_1, F_2, F_3, F_4$

```{r}
ggarrange(
fviz_contrib(acm, choice="var", axes =1,
               fill = "#CD6155", color = "#CD6155") + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
fviz_contrib(acm, choice="var", axes =2,
               fill = "#CD6155", color = "#CD6155") + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
  fviz_contrib(acm, choice="var", axes =3,
               fill = "#CD6155", color = "#CD6155") + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
  fviz_contrib(acm, choice="var", axes =4,
               fill = "#CD6155", color = "#CD6155") +
    theme(axis.text.x = element_text(size=7),title = element_text(size=10))
)
```

Nous remarquons une tendance générale de la contributuon des modalités pour les deux premiers axes. Contrairement aux deux autres, qui montrent une tendance particulère (peu de variables contribuent à ces axes).Grâce à un datatable, nous pouvons voir quelles modalités contribuent le plus aux différentes dimensions.


```{r}
as.data.frame (acm$var$contrib[,1:4]) %>% datatable ()
```


Pour expliquer la contribution des variables aux axes, nous pouvons regarder le rapport de corrélation de celles-ci à l'aide d'un graphique. Nous remarquons, que la variable Revenu contribue aux deux axes. La variable Teenhome semble contribuer essentiellement à la dimension 2. Tandis que, la dépense en vin, semble se rapprocher de l'axe 1. Enfin, l'axe F3 est principalement expliqué par la dépense en viande et l'achat sur catalogue.
```{r}
par(mfrow = c(1,2))
plot(acm, axes=c(1,2), choix="var", col.var="#B95945", title="Rapport de corrélation plan (F1,F2)") #graph variables.
plot(acm, axes=c(3,4), choix="var", col.var="#B95945", title="Rapport de corrélation plan (F3,F4)")
```




### Nuage des variables

```{r}
fviz_mca_var(acm, axes=c(1,2),geom = c("point","text"),repel=T, 
             title="Nuage des variables sur (F1,F2)",
             col.var = "cos2",gradient.cols = c("#F5B9B9","#E31F1F", "#6B0C0C"),
             ggtheme = theme_minimal())
```

<p class="content">Interprétations des axes : </p>
- Axe $F_1$ :
Nous remarquons des modalités qui s'éloignent vers la droite, du barycentre du nuage (individu qui possède un peu de toutes les modalités) telles que : les revenus les plus élevés **80000-700000**, la première et la cinquième campagne de remise, les dépenses les plus hautes en viande (575-1150) et en vin (996-1494).Cependant vers la gauche, nous retrouvons les salaires les plus faibles qui semblent s'éloigner du barycentre (20000-30000).  
Ainsi, on peut dire que l'axe $F_1$ oppose principalement les salaires élevés aux salaires les plus faibles ainsi que les clients ayant des mineurs (enfants et/ou adolescents) aux clients qui n'en n'ont pas.

- Axe $F_2$ : Celui-ci oppose les consommateurs n'ayant pas d'adolescents à ceux qui en ont. Nous remarquons également une opposition entre les revenus extrêmes aux revenus intermédiaires donc la dépense dans les produits suit logiquement le type de revenu. 


<br>

```{r}
fviz_mca_var(acm, axes=c(3,4),geom = c("point","text"),repel=T, 
             title="Nuage des variables sur  le plan (F3,F4)",
             col.var = "cos2",gradient.cols = c("#F5B9B9","#E31F1F", "#6B0C0C"),
             ggtheme = theme_minimal())
```

Aucune modalité a une bonne qualité de représentation pour être interprétée. Sauf, les achats sur catalogue et la dépense en viande. Ces deux modalités semblent contribuer à l'axe $F_3$.Mais aussi, elles s'éloignent de la même façon du barycentre, celles-ci sont des modalités rares.



## Études des individus

### Contribution des individus
```{r}
ggarrange(
fviz_contrib(acm, choice="ind", axes =1,
               fill = "#CD6155", color = "#CD6155", top =150) + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
fviz_contrib(acm, choice="ind", axes =2,
               fill = "#CD6155", color = "#CD6155", top= 150) + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
  fviz_contrib(acm, choice="ind", axes =3,
               fill = "#CD6155", color = "#CD6155", top = 150) + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10)),
  fviz_contrib(acm, choice="ind", axes =4,
               fill = "#CD6155", color = "#CD6155", top =150) + 
    theme(axis.text.x = element_text(size=7),title = element_text(size=10))
)
```

On remarque une tendance particulière pour la contribution des individus sur $F_3$.Nous pouvons voir quels individus contribuent le plus aux différentes dimensions.

```{r}
as.data.frame (acm$ind$contrib[,1:4]) %>% datatable ()
```




### Nuage des individus 
```{r}
fviz_mca_ind(acm,axes=c(1,2), geom="point",title="Nuage des individus sur (F1,F2)",repel=T,alpha =0.6, col.ind = "#D35400",pointsize=1.6)
```

Nous remarquons ici, un effet Guttman, en effet l'axe principal semble opposer les individus extrêmes. Ainsi, que l'axe $F_2$ qui semble opposer les individus moyens aux individus extrêmes. On remarque que certains individus s'éloignent du barycentre, on peut supposer que ceux-ci prennent des modalités rares. 

<br>
 
```{r}
fviz_mca_ind(acm,axes=c(3,4), geom="point",title="Nuage des individus sur (F3,F4)",repel=T,alpha =0.6, col.ind = "#D35400",pointsize=1.6)

```

On remarque des individus sur la droite qui s'éloignent du barycentre, ils semblent se rapprocher des modalités prises tels que la dépense en viande et les achats sur catalogue. comme vu précedemment sur le nuage des variables sur $(F_3,F_4)$.




## Étude simultanée
```{r}
ggarrange(
fviz_mca_biplot(acm, axes = c(1, 2), labelsize=3, col.ind="#F0B27A", col.var="#A93226", geom.ind="point", repel=TRUE, pointsize=1.9,shape.var=20),
fviz_mca_biplot(acm, axes = c(3, 4), labelsize=3, col.ind="#F0B27A", col.var="#A93226", geom.ind="point", repel=TRUE, pointsize=1.9,shape.var=20))
```

Nous pouvons désormais, faire des habillages sur les individus selon différentes modalités, pour nous aider à interpréter et mieux comprendre la position des individus. 

<p class="content">Habillage : </p>
* Education et Revenu :
```{r}
habillage <- function(x, n, axes = c(1,2)){
  fviz_mca_ind(x, geom="point", palette="OrRd",
               axes= axes,
               title = "",
               habillage = n, alpha = 0.6,
               pointsize=1.6,
               ggtheme = theme_minimal()
)
}
```

```{r}
ggarrange(
  habillage(acm, 1), habillage(acm,13))
```

Nous remarquons spontanément que les clients ayant un niveau d'étude **2n Cycle** ou **Basic** se situent particulièrement sur la gauche. Or, nous avons vu précédemment que les clients ayant des faibles revenus sont situés sur cette partie du plan, le deuxième graphique nous le confirme. Donc les individus n'ayant pas un haut niveau d'étude, et donc gagnant un salaire faible se situent sur le même quart de plan.

<br>

* Dépense par produit :
```{r}
ggarrange(
  habillage(acm, 20), habillage(acm, 21), habillage(acm, 22),
  habillage(acm, 23), habillage(acm, 24), habillage(acm, 25))
```

Ces graphiques nous montrent que les clients qui dépensent beaucoup pour les différents produits se situent vers la droite des plans.Cette intensité de dépense suit l'intensité des revenus. Cependant, nous remarquons que pour le produit viande, les individus qui dépensent plus s'isolent des autres individus.

<br>

* Mineurs :
```{r}
ggarrange(
  habillage(acm, 3), habillage(acm, 4))
```

Les clients ayant des enfants se situent sur la gauche. Contrairement à ceux qui ont des adolescents à charge qui se situent vers le bas. 

<br>

* Statut civil :
```{r}
ggarrange(habillage(acm, 2))
```
Il n'y a pas de tendance sur la répartition des clients selon leurs statuts civils

 <br> 
 
* Lieux d'achats : 
```{r}
ggarrange(habillage(acm, 17),habillage(acm, 16),habillage(acm, 15))
```

Nous remarquons que les achats effectués en boutique sont plus situés sur le côté droit du plan. On peut penser que c'est logique car les individus ayant des revenus intermédiaires et élevés dépensent plus ou achètent plus souvent des produits d'où la concentration des points sur cette zone.

# Clustering
L’objectif est de distinguer des sous-ensembles homogènes permettant de segmenter la population étudiée afin de mettre en place des stratégies commerciales dans le but d'optimiser le profit des entreprises. 

## Classification hiérarchique ascendante
Nous allons effectuer, dans un premier temps, une partition des individus de notre base de données. Pour cela nous utilisons la méthode de la classification hiérarchique ascendante. Nous choisissons cette méthode puisque le nombre de classes n'est pas fixé, nous laissons donc le logiciel choisir. Après plusieurs essais, nous retenons la classification par la méthode de Ward puisqu'elle maximise l'inertie inter-classes. 
```{r}
class <- HCPC(acm, nb.clust = -1, consol = TRUE, metric = "euclidian", method = "ward", graph = FALSE)
fviz_cluster(class, geom = "point", ellipse = FALSE, show.clust.cent = FALSE, alpha= 0.8, palette = c("#fc9272", "#cb181d", "#67000d"), ggtheme = theme_minimal()) + labs(title = "Visualisation des groupes") + theme(legend.position = "none")
fviz_cluster(class, axes = c(3,4), geom = "point", ellipse = FALSE, show.clust.cent = FALSE, alpha= 0.8, palette = c("#fc9272", "#cb181d", "#67000d"), ggtheme = theme_minimal()) + labs(title = "Visualisation des groupes") + theme(legend.position = "none")
```
Nous remarquons trois groupes distincts, dont un composé d'individus qui s'isolent du reste de la population. Ce dernier groupe se distingue davantage du reste de la population sur la dimension 3.

## Nombre optimal de classes
```{r}
fviz_nbclust(acm$ind$coord, hcut, method = "wss",linecolor = "grey") +
    geom_point(shape=19, color="#B21515", fill="#B21515",alpha=0.8, size=6) +
    ggtitle("Nombre optimal de classes (Elbow method)") +
    labs(y="Total within sum of square",x="Nombre de clusters") +
  geom_vline(xintercept = 3, linetype = 2) +
  theme_minimal() 
```

```{r}
fviz_nbclust(acm$ind$coord, hcut, method = "silhouette",linecolor = "grey") +
    geom_point(shape=19, color="#B21515", fill="#B21515",alpha=0.8, size=6) +
    ggtitle("Nombre optimal de classes (Average silhouette)") +
    labs(y="Average silhouette width",x="Nombre de clusters") +
  geom_vline(xintercept = 3, linetype = 2) +
  theme_minimal() 
```
**Elbow method :** Il est plus intéressant de faire 2, 3 ou 4 classes.

**Silhouette method :** On observe qu'effectuer une partition en 3 classes semble être la solution la plus intéressante.

## CAH en trois classes
```{r}
class_cluster <- HCPC(acm, nb.clust = 3, consol = FALSE, metric = "euclidian", method = "ward", graph = FALSE)
fviz_dend(class_cluster, k = 3, cex= 0.3, k_colors = c("#cb181d", "#fc9272", "#67000d"), main = "Dendrogramme d'une classification avec la méthode de Ward", type = "rectangle")
```

```{r}
a<-fviz_cluster(class_cluster, geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des classes sur (F1,F2)")
b<-fviz_cluster(class_cluster,axes=c(3,4), geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des classes sur (F3,F4)")
ggarrange(a, b, ncol = 2)
```
La classification avec le nombre optimal de classes semble être similaire à notre classification précédente. Les classes 1 et 3 se distinguent peu sur les quatre premières dimensions. Essayons d'améliorer notre classification.

## Amélioration de la CAH
### On enlève le bruit
Pour éviter de donner trop de poids à des individus aberrants (ou des erreurs), on ne conserve qu’une représentation des données correspondant à 95% de l’inertie totale.
```{r, results= FALSE}
barplot(acm$eig[,3],names.arg=1:53,las=1,cex.names=0.5,yaxs="i",
               main="Inerties relatives cumulées",width=0.25,space=0.75,
               xlab="Axes factoriels", ylab="Inerties cummulées",
               col = "#F8F5F0", border = "#ABA37F") +
  abline(h=95,col="red",lty="dashed") +
  text(x=23,y=97,"95%",col="red",cex = 0.8)
```
En conservant seulement 95% de l'inertie totale cumulée, nous allons effectuer notre classification sur 45 axes (initialement 53 axes).

### CAH sans consolidation
```{r}
acm2 <- MCA(donnees,graph=FALSE, ncp=45)
cah_noconso <- HCPC(acm2,nb_clust=3,consol=FALSE,metric="euclidean", method="ward",graph = FALSE)
```

```{r}
a<-fviz_cluster(cah_noconso, geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des classes sur (F1,F2)")
b<-fviz_cluster(cah_noconso, axes=c(3,4),geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des classes sur (F3,F4)")
ggarrange(a,b, ncol = 2)
```


### CAH avec consolidation
```{r}
cah_conso <- HCPC(acm2, nb.clust = 3, metric="euclidean", method="ward",graph = FALSE, consol=TRUE)
```

```{r}
a<-fviz_cluster(cah_conso, geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des clusters sur (F1,F2)")
b<-fviz_cluster(cah_conso, axes=c(3,4),geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "Visualisation des clusters sur (F3,F4)")
ggarrange(a, b, ncol = 2)
```

Nous observons un changement après consolidation : les classes 1 et 3 se distinguent davantage sur les premiers axes factoriels. Il faut maintenant vérifier que l'inertie inter-classes est plus élevée dans le cas d'une classification avec consolidation, puisque cette dernière permet d'améliorer la partition :

- inertie inter-classes de la classification **sans consolidation** : `r round(cah_conso$call$bw.before.consol,3)`
- inertie inter-classes de la classification **avec consolidation** : `r round(cah_conso$call$bw.after.consol,3)`

Cela étant vérifié, il nous faut par la suite caractériser les classes résultant de notre classification afin de cibler au mieux les individus et leur comportement de consommateur.

## Caractérisation des classes
### Par des variables qualitatives
$\rightarrow$ *Veuillez scroller, pour pouvoir observer la totalité des tableaux*
<div class="table-wrapper">
```{r}
cah_conso$desc.var$test.chi2 %>% kable(caption = "Quelles sont les variables caracétrisant le mieux la partition ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))

```
</div>

<br/>
Les premières variables (**AchatsCatlog**, **Meat**, **Revenu**) du tableau sont celles qui sont le plus liées, qui caractérisent donc le mieux la partition.

<br/>

<div class="table-wrapper">
```{r}
round(cah_conso$desc.var$category$'1',1) %>% kable(caption = "Quelles sont les modalités caractérisant le mieux la première classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
</div>

<br/>
Les consommateurs de cette classe ont des revenus relativement faibles. La totalité des individus avec un revenu compris entre 15000 et 30000 sont dans cette première classe et 98.1% des individus avec un revenu compris entre 1500 et 15000, et entre 30000 et 45000 le sont également. Même si certains consommateurs ont des revenus plus élevés, le revenu moyen de cette classe reste relativement bas.

De plus, on remarque que ces individus ont un comportement de consommateur plutôt "timide", ils dépensent peu pour les produits de notre étude. Si nous prenons l'exemple de la dépense en vin, parmi les individus de cette classe, 97.5% dépensent entre 0 et 498 en vin. Ce comportement est remarquable également par leur faible fréquence d'achat en magasin. Cependant, une majorité surveille fréquemment les sites internet. La totalité des individus qui visitent le plus les sites internet et 87.8% des consommateurs le faisant très régulièrement sont dans cette classe. Attention toute fois à être vigilant avec cette remarque, puisque 47.8% des individus de cette classe visitent très peu les sites internet.

Concernant le nombre d'enfants dans leur foyer, on peut dire qu'il est plus élevé que dans les autres classes puisque la totalité des individus avec deux enfants à charge et 95.4% avec un enfant sont dans cette classe. En ce qui concerne le nombre d'adolescents dans leur foyer, il est plus faible. Au sein de cette classe, 46.9% des individus n'ont pas d'adolescent et 50.4% ont un adolescent à charge. 

<div class="table-wrapper">
```{r}
round(cah_conso$desc.var$category$'2',1) %>% kable(caption = "Quelles sont les modalités caractérisant le mieux la deuxième classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
</div>

Parmi les individus de cette classe, 75% ont un revenu compris entre 80000 et 700000. Cependant, cette classe comporte peu d'individus ce qui explique que seulement 1.4% des individus avec ce revenu sont dans cette classe. En regardant la consommation de ces individus, nous pouvons voir que la totalité des individus dépensant le plus en viande se trouve dans cette classe. Et donc, aucun individu dans cette classe dépense peu en viande. Pour ce qui est des achats effectués sur catalogue, 100% des individus effetuant un grand nombre d'achats sur catalogue se trouvent dans cette classe. De plus, tous les individus achètent au moins 19 fois sur catalogue.

<br/>

<div class="table-wrapper">
```{r}
round(cah_conso$desc.var$category$'3',1) %>% kable(caption = "Quelles sont les modalités caractérisant le mieux la troisième classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
</div>

<br/>
Globalement, les individus de cette classe ont peu d'enfant, 95.2% n'en n'ont pas et 4.8% ont seulement un enfant. En outre, 89.9% des individus ayant un revenu compris entre 65000 et 80000 et 95.9% avec un revenu compris entre 80000 et 700000 sont dans cette classe. En ce qui concerne leur comportement de consommateur, on peut voir qu'ils ont tendance à dépenser beaucoup en viande et en poisson. En effet, 97.5% des individus qui ont une une dépense conséquente en viande, ainsi que 96.2% avec une dépense conséquente en poisson sont dans cette classe. Enfin, 93.5% (38.7+54.8) des individus de cette classe achètent beaucoup en magasin. 


### Par des variables quantitatives
<div class="table-wrapper">
```{r}
cah_conso$desc.axes$quanti.var %>% kable(caption = "Quelles sont les variables caractérisant le mieux la partition ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
</div>
Les dimensions 1 et 3 caractérisent le mieux la partition puisqu'elles ont les  p-value les plus petites et permettent donc de bien séparer les classes. 

```{r}
cah_conso$desc.axes$quanti$'1' %>% kable(caption = "Quelles sont les variables caractérisant le mieux la première classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
La dimension 7 caractérise le mieux la première classe car elle a la valeur test la plus grande. Cette classe correspond aux axes 7 et 4. 

```{r}
cah_conso$desc.axes$quanti$'2' %>% kable(caption = "Quelles sont les variables caractérisant le mieux la deuxième classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```

La dimension 3 caractérise le mieux la deuxième classe car elle a la valeur test la plus grande. Cette classe correspond principlamenent à l'axe 3 qui représente l'achat sur catalogue et la dépense en viande.  

```{r}
cah_conso$desc.axes$quanti$'3' %>% kable(caption = "Quelles sont les variables caractérisant le mieux la troisième classe ?",align = "c") %>% 
  kable_styling(full_width = TRUE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed"))
```
La dimension 1 caractérise le mieux la troisième classe car elle a la valeur test la plus grande. Cette classe correspond à l'axe 1 qui oppose principalement les revenus élevés aux revenus les plus faibles ainsi que les individus ayant des mineurs (enfants et/ou adolescents) aux individus qui n’en n’ont pas



### Par les individus
```{r}
cah_conso$desc.ind$para
```

```{r}
a<-fviz_mca_ind(acm, geom="point", col.ind= ifelse(rownames(donnees)==7533, "Parangon classe 1", ifelse(rownames(donnees)==1501 , "Parangon classe 2", ifelse(rownames(donnees)==10582, "Parangon classe 3", "Population"))), palette = c("#cb181d", "#fc9272", "#67000d", "gray"),
                repel = TRUE, alpha = 0.6, axes = c(1,2), title = "Parangons sur (F1,F2)",
                ggtheme = theme_minimal())
b<-fviz_mca_ind(acm, geom="point", col.ind= ifelse(rownames(donnees)==7533, "Parangon classe 1", ifelse(rownames(donnees)==1501 , "Parangon classe 2", ifelse(rownames(donnees)==10582, "Parangon classe 3", "Population"))), palette = c("#cb181d", "#fc9272", "#67000d", "gray"),
                repel = TRUE, alpha = 0.6, axes = c(3,4), title = "Parangons sur (F3,F4)",
                ggtheme = theme_minimal())
ggarrange(a, b, ncol = 2)
```

#### Parangon classe 1
Étudions les parangons de la classe 1 pour étailler nos propos précédents. 
```{r}
col1 <-c(donnees$Revenu[which(rownames(donnees)==4368)],donnees$Revenu[which(rownames(donnees)==7533)],
         donnees$Revenu[which(rownames(donnees)==2404)],donnees$Revenu[which(rownames(donnees)==3386)],
         donnees$Revenu[which(rownames(donnees)==8175)])

col2<-c(donnees$Meat[which(rownames(donnees)==4368)],donnees$Meat[which(rownames(donnees)==7533)],
        donnees$Meat[which(rownames(donnees)==2404)],donnees$Meat[which(rownames(donnees)==3386)],
        donnees$Meat[which(rownames(donnees)==8175)])

col3<-c(donnees$Wines[which(rownames(donnees)==4368)],donnees$Wines[which(rownames(donnees)==7533)],
        donnees$Wines[which(rownames(donnees)==2404)],donnees$Wines[which(rownames(donnees)==3386)],
        donnees$Wines[which(rownames(donnees)==8175)])

col4<-c(donnees$Fish[which(rownames(donnees)==4368)],donnees$Fish[which(rownames(donnees)==7533)],
        donnees$Fish[which(rownames(donnees)==2404)],donnees$Fish[which(rownames(donnees)==3386)],
        donnees$Fish[which(rownames(donnees)==8175)])

col5<-c(donnees$Gold[which(rownames(donnees)==4368)],donnees$Gold[which(rownames(donnees)==7533)],
        donnees$Gold[which(rownames(donnees)==2404)],donnees$Gold[which(rownames(donnees)==3386)],
        donnees$Gold[which(rownames(donnees)==8175)])

tableau1 <- cbind(col1, col2, col3, col4, col5)
colnames(tableau1) = c("Revenu","Dépense viande", "Dépense vin", "Dépense poisson","Dépense or")
rownames(tableau1) = c("Individu 4368", "Individu 7533", "Individu 2404", "Individu 3386","Individu 8175")

tableau1 %>% kable(caption = "Parangons classe 1",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed")) 

col6<-c(donnees$Fruits[which(rownames(donnees)==4368)],donnees$Fruits[which(rownames(donnees)==7533)],
        donnees$Fruits[which(rownames(donnees)==2404)],donnees$Fruits[which(rownames(donnees)==3386)],
        donnees$Fruits[which(rownames(donnees)==8175)])

col7<-c(donnees$Sweet[which(rownames(donnees)==4368)],donnees$Sweet[which(rownames(donnees)==7533)],
        donnees$Sweet[which(rownames(donnees)==2404)],donnees$Sweet[which(rownames(donnees)==3386)],
        donnees$Sweet[which(rownames(donnees)==8175)])

col8<-c(donnees$AchatsStores[which(rownames(donnees)==4368)],donnees$AchatsStores[which(rownames(donnees)==7533)],
        donnees$AchatsStores[which(rownames(donnees)==2404)],donnees$AchatsStores[which(rownames(donnees)==3386)],
        donnees$AchatsStores[which(rownames(donnees)==8175)])

col9<-c(donnees$Webvisit[which(rownames(donnees)==4368)],donnees$Webvisit[which(rownames(donnees)==7533)],
        donnees$Webvisit[which(rownames(donnees)==2404)],donnees$Webvisit[which(rownames(donnees)==3386)],
       donnees$Webvisit[which(rownames(donnees)==8175)])

col10<-c(donnees$Teenhome[which(rownames(donnees)==4368)],donnees$Teenhome[which(rownames(donnees)==7533)],
       donnees$Teenhome[which(rownames(donnees)==2404)],donnees$Teenhome[which(rownames(donnees)==3386)],
       donnees$Teenhome[which(rownames(donnees)==8175)])

col11<-c(donnees$Kidhome[which(rownames(donnees)==4368)],donnees$Kidhome[which(rownames(donnees)==7533)],
       donnees$Kidhome[which(rownames(donnees)==2404)],donnees$Kidhome[which(rownames(donnees)==3386)],
       donnees$Kidhome[which(rownames(donnees)==8175)])

tableau2 <- cbind(col6, col7, col8, col9, col10, col11)
colnames(tableau2) = c("Dépense fruits","Dépense bonbons","Achats en magasin", "Visite sites",
                      "Adolescents à charge", "Enfants à charge")
rownames(tableau2) = c("Individu 4368", "Individu 7533", "Individu 2404", "Individu 3386","Individu 8175")

tableau2 %>% kable(caption = "",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed")) 
```
Nous remarquons qu'ils ont un revenu moyen, dépensent très peu dans tous les produits, achètent peu en magasin et ont un nombre moyen de mineurs au sein de leur foyer.

#### Parangon classe 2
Étudions les parangons de la classe 2 pour étailler nos propos précédents. 
```{r}
col1 <-c(donnees$Revenu[which(rownames(donnees)==1501)],
donnees$Revenu[which(rownames(donnees)==8475)],
donnees$Revenu[which(rownames(donnees)==5376)],
donnees$Revenu[which(rownames(donnees)==4931)])
col2 <- c(donnees$AchatsCatalog[which(rownames(donnees)==1501)],donnees$AchatsCatalog[which(rownames(donnees)==8475)],donnees$AchatsCatalog[which(rownames(donnees)==5376)],donnees$AchatsCatalog[which(rownames(donnees)==4931)])
col3<-c(donnees$Meat[which(rownames(donnees)==1501)],donnees$Meat[which(rownames(donnees)==8475)],donnees$Meat[which(rownames(donnees)==5376)],donnees$Meat[which(rownames(donnees)==4931)])
tableau <- cbind(col1,col2, col3)
colnames(tableau) = c("Revenu","Achats sur catalogue", "Dépense en viande")
rownames(tableau) = c("Individu 1501", "Individu 8475", "Individu 5376", "Individu 4931")

tableau %>% kable(caption = "Parangons classe 2",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed")) 
```
Nous remarquons que dans l'ensemble, les paragons de cette classe remplissent les critères de caractérisation de la classe trouvéé précedemment.

#### Parangon classe 3
Étudions les parangons de la classe  pour étailler nos propos précédents. 
```{r}
col1 <-c(donnees$Revenu[which(rownames(donnees)==10582)],donnees$Revenu[which(rownames(donnees)==5562)],
         donnees$Revenu[which(rownames(donnees)==6001)],donnees$Revenu[which(rownames(donnees)==2579)],
         donnees$Revenu[which(rownames(donnees)==6327)])

col2<-c(donnees$Meat[which(rownames(donnees)==10582)],donnees$Meat[which(rownames(donnees)==5562)],
        donnees$Meat[which(rownames(donnees)==6001)],donnees$Meat[which(rownames(donnees)==2579)],
        donnees$Meat[which(rownames(donnees)==6327)])

col3<-c(donnees$Fish[which(rownames(donnees)==10582)],donnees$Fish[which(rownames(donnees)==5562)],
        donnees$Fish[which(rownames(donnees)==6001)],donnees$Fish[which(rownames(donnees)==2579)],
        donnees$Fish[which(rownames(donnees)==6327)])

col4<-c(donnees$Kidhome[which(rownames(donnees)==10582)],donnees$Kidhome[which(rownames(donnees)==5562)],
       donnees$Kidhome[which(rownames(donnees)==6001)],donnees$Kidhome[which(rownames(donnees)==2579)],
       donnees$Kidhome[which(rownames(donnees)==6327)])

col5<-c(donnees$AchatsStores[which(rownames(donnees)==10582)],
        donnees$AchatsStores[which(rownames(donnees)==5562)],
        donnees$AchatsStores[which(rownames(donnees)==6001)],donnees$AchatsStores[which(rownames(donnees)==2579)],
        donnees$AchatsStores[which(rownames(donnees)==6327)])

tableau1 <- cbind(col1, col2, col3, col4, col5)
colnames(tableau1) = c("Revenu","Dépense viande", "Dépense poisson", "Enfants à charge","Achats magasin")
rownames(tableau1) = c("Individu 10582", "Individu 5562", "Individu 6001", "Individu 2579","Individu 6327")

tableau1 %>% kable(caption = "Parangons classe 3",align = "c") %>% 
  kable_styling(full_width = FALSE, 
                position = "center",
                bootstrap_options = c("hover","striped","condensed")) 
```
Nous remarquons que dans l'ensemble, les paragons de cette classe illustrent bien les caractéristiques des individus de cette classes mise à part pour la dépense en viande et en poisson.

# Conclusion 
Après avoir effectué plusieurs analyses factorielles et une classification, nous obtenons trois classes d'individus à cibler. Nous avons constaté un effet Guttman dès notre Analyse Factorielle des Correspondances. Celui-ci nous permet de déduire que le niveau de revenu oriente le niveau de dépense pour les différents produits. 

En effet, les consommateurs appartenant à la première classe ont un train de vie modeste, ce qui traduit des revenus faibles et moyens. Ces individus n'ont notamment pas un niveau d'étude très élevés (2nd Cycle et Basic) et ils ont des enfants à charges ce qui traduirait la fréquence d'achats et de visite sur le site internet. Ainsi, ces consommateurs vont principalement acheter des produits de premières nécessité, et non des produits de confort comme ceux présents dans notre base de données. Afin de stimuler cette demande, les entreprises ont intérêt à effectuer des stratégies promotionnelles principalemment établies sur le site internet.

Pour reprendre l'effet Guttman, en opposition à cette classe, nous retrouvons les consommateurs de la troisième classe qui ont des revenus plus importants. Cette classe est fondamentale puisqu'elle représente la part la plus conséquente d'individus avec un niveau de dépenses élevés. De plus, ceux sont ces individus qui achètent principalement en magasin. Ainsi, il est cruciale pour les entreprises de promouvoir des biens de qualités auprès de cette classe.

Enfin, il existe une autre classe qui regroupe peu de consommateurs ayant des caractéristiques plutôt rares telles qu'un revenu extrêmement élevé, une dépense en viande excessive et un nombre élevé d'achats sur catalogue. Cela s'explique par le fait que les biens vendus sur catalogues sont onéreux, comme vu précédemment dans l'Analyse par Composantes Principales.

Pour étailler davantage notre étude, nous pouvons décrire la position des parangons. Ceux-ci sont placés à l'intersection des classes 1 et 3, ce qui explique leur comportement intermédiaire (un revenu intermédiraire, une dépense moyenne). En outre, ces consommateurs ont généralement des adolescents à charge.  Après avoir pris connaissance de toutes ces informations, nous pouvons remaquer un effet graphique : il apparaît que l'évolution des mineurs dans le foyer représente un certain cycle de vie des consommateurs. En effet, chaque classe représente un moment de la vie de ceux-ci, c'est-à-dire la classe 1 représente les consommateurs avec des revenus faibles et des enfants, les parangons représentent les consommateurs avec des revenus intermédiaires et des adolescents à charges, enfin la clase 3 représente les consommateurs avec des revenus élevés et aucun mineur à charge. Attention toutefois à nuancer ce propos puisque certains consommateurs ne suivent pas ce cycle. Nous pouvons le voir graphiquement :

```{r}
a<-fviz_cluster(cah_conso, geom="point", elipse = FALSE, show.clust.cent = FALSE, alpha = 0.4, 
          palcex= 0.3, k_colors = "black", palette = c("#cb181d", "#fc9272", "#67000d"), 
          ggtheme = theme_minimal(),
          main = "")
ggarrange(habillage(acm, 19),a)
```

Cette information est cruciale pour la stratégie marketing des entreprises puisqu'elle leur permettra d'adapter la promotion de ces produits aux différentes générations de consommateurs.